import{_ as G,r as h,q as Z,D as T,G as ee,a as _,b as i,c as f,e as l,w as n,d as e,t as u,l as c,H as I,z as M,i as w,E as d,g as N,p as te,u as se,I as ae,o as le,h as x,F as H,f as J,J as P,m as oe,K as ne,L as re,M as ue,N as ie,O as de,P as ce,Q as _e}from"./index-05c20d45.js";import{R as ve}from"./ResourceCard-3862d34a.js";const pe={class:"rental-form"},me={class:"cost-breakdown"},fe={class:"cost-item"},ge={key:0,class:"cost-item"},ye={class:"cost-total"},he={class:"form-actions"},we={__name:"RentalForm",props:{resource:{type:Object,required:!0}},emits:["success","cancel"],setup(S,{emit:E}){const g=S,k=E,D=h(),s=h(!1),r=Z({startDate:null,endDate:null,remark:""}),v=T(()=>!r.startDate||!r.endDate?0:ee(r.startDate,r.endDate)),p=T(()=>v.value*g.resource.price_per_day),C=T(()=>p.value+(g.resource.deposit||0)),F={startDate:[{required:!0,message:"请选择开始日期",trigger:"change"}],endDate:[{required:!0,message:"请选择结束日期",trigger:"change"}]},U=m=>m<new Date().setHours(0,0,0,0),z=m=>r.startDate?m<=r.startDate:!0,j=()=>{},O=async()=>{if(D.value)try{if(!await D.value.validate())return;if(v.value<=0){d.error("租赁天数必须大于0");return}s.value=!0;const a={resource_id:g.resource.id,start_date:r.startDate,end_date:r.endDate,remark:r.remark},b=await N.post("/orders",a);b.data.status==="success"?(d.success("租赁申请已提交"),k("success")):d.error(b.data.message||"提交失败")}catch(m){console.error("提交租赁申请失败:",m),d.error("提交失败，请稍后重试")}finally{s.value=!1}};return(m,a)=>{const b=_("el-date-picker"),R=_("el-form-item"),q=_("el-input"),B=_("el-button"),o=_("el-form");return i(),f("div",pe,[l(o,{ref_key:"formRef",ref:D,model:r,rules:F,"label-width":"80px",size:"large"},{default:n(()=>[l(R,{label:"开始日期",prop:"startDate"},{default:n(()=>[l(b,{modelValue:r.startDate,"onUpdate:modelValue":a[0]||(a[0]=t=>r.startDate=t),type:"date",placeholder:"选择开始日期","disabled-date":U,style:{width:"100%"},onChange:j},null,8,["modelValue"])]),_:1}),l(R,{label:"结束日期",prop:"endDate"},{default:n(()=>[l(b,{modelValue:r.endDate,"onUpdate:modelValue":a[1]||(a[1]=t=>r.endDate=t),type:"date",placeholder:"选择结束日期","disabled-date":z,style:{width:"100%"},onChange:j},null,8,["modelValue"])]),_:1}),l(R,{label:"租赁天数"},{default:n(()=>[l(q,{value:v.value+" 天",readonly:""},null,8,["value"])]),_:1}),l(R,{label:"备注",prop:"remark"},{default:n(()=>[l(q,{modelValue:r.remark,"onUpdate:modelValue":a[2]||(a[2]=t=>r.remark=t),type:"textarea",rows:3,placeholder:"请输入备注信息（可选）",maxlength:"200","show-word-limit":""},null,8,["modelValue"])]),_:1}),e("div",me,[a[9]||(a[9]=e("h4",null,"费用明细",-1)),e("div",fe,[a[4]||(a[4]=e("span",null,"日租金：",-1)),e("span",null,"¥"+u(c(I)(S.resource.price_per_day))+" × "+u(v.value)+" 天",1),e("span",null,"¥"+u(c(I)(p.value)),1)]),S.resource.deposit>0?(i(),f("div",ge,[a[5]||(a[5]=e("span",null,"押金：",-1)),a[6]||(a[6]=e("span",null,null,-1)),e("span",null,"¥"+u(c(I)(S.resource.deposit)),1)])):M("",!0),e("div",ye,[a[7]||(a[7]=e("span",null,"总计：",-1)),a[8]||(a[8]=e("span",null,null,-1)),e("span",null,"¥"+u(c(I)(C.value)),1)])]),a[12]||(a[12]=e("div",{class:"rental-notice"},[e("h4",null,"租赁须知"),e("ul",null,[e("li",null,"请按约定时间地点取还物品"),e("li",null,"使用过程中请爱护物品，如有损坏需要赔偿"),e("li",null,"押金将在物品正常归还后全额退还"),e("li",null,"如有问题请及时联系物主或客服")])],-1)),e("div",he,[l(B,{onClick:a[3]||(a[3]=t=>m.$emit("cancel"))},{default:n(()=>a[10]||(a[10]=[w("取消")])),_:1,__:[10]}),l(B,{type:"primary",loading:s.value,onClick:O},{default:n(()=>a[11]||(a[11]=[w(" 提交申请 ")])),_:1,__:[11]},8,["loading"])])]),_:1,__:[12]},8,["model"])])}}},ke=G(we,[["__scopeId","data-v-27330002"]]);const De={class:"resource-detail-page"},be={key:0,class:"loading-container"},Ce={key:1,class:"container"},Re={class:"resource-detail"},$e={class:"resource-images"},Ve=["src","alt"],xe={key:1,class:"single-image"},Ie=["src","alt"],Se={class:"resource-info"},Fe={class:"resource-header"},ze={class:"resource-status"},Le={class:"resource-meta"},Ne={class:"meta-item"},Te={class:"meta-item"},Ue={class:"meta-item"},je={class:"resource-price"},qe={class:"price-main"},Be={class:"price"},Me={key:0,class:"price-deposit"},Ee={class:"resource-description"},Oe={class:"rental-actions"},Ae={class:"owner-info"},He={class:"owner-card"},Je={class:"owner-details"},Pe={class:"owner-actions"},Ge={key:0,class:"related-resources"},Ke={class:"related-grid"},Qe={__name:"ResourceDetail",setup(S){const E=te(),g=se(),k=ae(),D=h(!0),s=h(null),r=h([]),v=h(!1),p=h(!1),C=h(!1),F=T(()=>{var o;if(!((o=s.value)!=null&&o.images))return["/images/placeholder.jpg"];if(Array.isArray(s.value.images))return s.value.images.length>0?s.value.images.map(t=>P(t)):["/images/placeholder.jpg"];try{const t=JSON.parse(s.value.images);return t.length>0?t.map($=>P($)):["/images/placeholder.jpg"]}catch{return["/images/placeholder.jpg"]}}),U=T(()=>{var o,t;return k.isLoggedIn&&((o=k.user)==null?void 0:o.id)===((t=s.value)==null?void 0:t.user_id)}),z=async()=>{try{D.value=!0;const o=E.params.id,t=await N.get(`/resources/${o}`);t.data.status==="success"?(s.value=t.data.data.resource,r.value=t.data.data.resource.related_resources||[]):(d.error("资源不存在"),g.push("/404"))}catch(o){console.error("获取资源详情失败:",o),d.error("获取资源详情失败"),g.push("/404")}finally{D.value=!1}},j=o=>({available:"success",rented:"danger",maintenance:"warning",offline:"info"})[o]||"info",O=o=>_e(o),m=o=>{g.push(`/resources/${o}`),z()},a=()=>{console.log("编辑资源")},b=async()=>{if(k.isLoggedIn)try{const o=await N.get(`/favorites/check/${s.value.id}`);o.data.status==="success"&&(p.value=o.data.data.isFavorited)}catch(o){console.error("检查收藏状态失败:",o)}},R=async()=>{var o,t;if(!k.isLoggedIn){d.warning("请先登录后再收藏"),g.push("/login");return}if(!C.value)try{C.value=!0,p.value?(await N.delete(`/favorites/${s.value.id}`),p.value=!1,d.success("取消收藏成功")):(await N.post("/favorites",{resource_id:s.value.id}),p.value=!0,d.success("收藏成功"))}catch($){console.error("收藏操作失败:",$),d.error(((t=(o=$.response)==null?void 0:o.data)==null?void 0:t.message)||"操作失败")}finally{C.value=!1}},q=()=>{if(!k.isLoggedIn){d.warning("请先登录后再联系卖家"),g.push("/login");return}const o=s.value.contact_info||s.value.owner_phone;o?d({message:`卖家联系方式：${o}`,type:"info",duration:0,showClose:!0}):d.info("卖家暂未提供联系方式，请通过租赁功能联系")},B=()=>{v.value=!1,d.success("租赁申请已提交"),z()};return le(async()=>{await z(),s.value&&b()}),(o,t)=>{const $=_("el-skeleton"),K=_("el-carousel-item"),Q=_("el-carousel"),W=_("el-tag"),V=_("el-icon"),L=_("el-button"),X=_("el-avatar"),Y=_("el-dialog");return i(),f("div",De,[D.value?(i(),f("div",be,[l($,{rows:8,animated:""})])):s.value?(i(),f("div",Ce,[e("div",Re,[e("div",$e,[F.value.length>1?(i(),x(Q,{key:0,height:"400px","indicator-position":"outside"},{default:n(()=>[(i(!0),f(H,null,J(F.value,(y,A)=>(i(),x(K,{key:A},{default:n(()=>[e("img",{src:y,alt:s.value.title},null,8,Ve)]),_:2},1024))),128))]),_:1})):(i(),f("div",xe,[e("img",{src:F.value[0],alt:s.value.title},null,8,Ie)]))]),e("div",Se,[e("div",Fe,[e("h1",null,u(s.value.title),1),e("div",ze,[l(W,{type:j(s.value.status)},{default:n(()=>[w(u(O(s.value.status)),1)]),_:1},8,["type"])])]),e("div",Le,[e("div",Ne,[l(V,null,{default:n(()=>[l(c(oe))]),_:1}),e("span",null,u(s.value.location||"位置未知"),1)]),e("div",Te,[l(V,null,{default:n(()=>[l(c(ne))]),_:1}),e("span",null,u(s.value.view_count||0)+" 次浏览",1)]),e("div",Ue,[l(V,null,{default:n(()=>[l(c(re))]),_:1}),e("span",null,"发布于 "+u(c(ue)(s.value.created_at)),1)])]),e("div",je,[e("div",qe,[e("span",Be,"¥"+u(c(I)(s.value.price_per_day)),1),t[3]||(t[3]=e("span",{class:"unit"},"/天",-1))]),s.value.deposit>0?(i(),f("div",Me," 押金：¥"+u(c(I)(s.value.deposit)),1)):M("",!0)]),e("div",Ee,[t[4]||(t[4]=e("h3",null,"物品描述",-1)),e("p",null,u(s.value.description||"暂无描述"),1)]),e("div",Oe,[s.value.status==="available"&&!U.value?(i(),x(L,{key:0,type:"primary",size:"large",onClick:t[0]||(t[0]=y=>v.value=!0)},{default:n(()=>t[5]||(t[5]=[w(" 立即租赁 ")])),_:1,__:[5]})):U.value?(i(),x(L,{key:1,size:"large",onClick:a},{default:n(()=>t[6]||(t[6]=[w(" 编辑物品 ")])),_:1,__:[6]})):(i(),x(L,{key:2,size:"large",disabled:""},{default:n(()=>t[7]||(t[7]=[w(" 暂不可租赁 ")])),_:1,__:[7]})),l(L,{size:"large",type:p.value?"warning":"default",loading:C.value,onClick:R},{default:n(()=>[l(V,null,{default:n(()=>[l(c(ie),{filled:p.value},null,8,["filled"])]),_:1}),w(" "+u(p.value?"已收藏":"收藏"),1)]),_:1},8,["type","loading"])])])]),e("div",Ae,[t[9]||(t[9]=e("h3",null,"物主信息",-1)),e("div",He,[l(X,{src:s.value.owner_avatar,size:60},{default:n(()=>[l(V,null,{default:n(()=>[l(c(de))]),_:1})]),_:1},8,["src"]),e("div",Je,[e("h4",null,u(s.value.owner_name),1),e("p",null,"真实姓名："+u(s.value.owner_real_name||"未提供"),1),e("p",null,"联系方式："+u(s.value.contact_info||"请通过平台联系"),1)]),e("div",Pe,[l(L,{size:"small",onClick:q},{default:n(()=>[l(V,null,{default:n(()=>[l(c(ce))]),_:1}),t[8]||(t[8]=w(" 联系卖家 "))]),_:1,__:[8]})])])]),r.value.length>0?(i(),f("div",Ge,[t[10]||(t[10]=e("h3",null,"相关推荐",-1)),e("div",Ke,[(i(!0),f(H,null,J(r.value,y=>(i(),x(ve,{key:y.id,resource:y,"view-mode":"grid",onClick:A=>m(y.id)},null,8,["resource","onClick"]))),128))])])):M("",!0)])):M("",!0),l(Y,{modelValue:v.value,"onUpdate:modelValue":t[2]||(t[2]=y=>v.value=y),title:"租赁申请",width:"500px"},{default:n(()=>[l(ke,{resource:s.value,onSuccess:B,onCancel:t[1]||(t[1]=y=>v.value=!1)},null,8,["resource"])]),_:1},8,["modelValue"])])}}},Ye=G(Qe,[["__scopeId","data-v-48e18944"]]);export{Ye as default};
