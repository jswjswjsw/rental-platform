import{_ as Q,u as W,I as X,r as U,q as Y,o as Z,a as v,v as ee,b as r,c as d,d as a,e as n,w as l,y as te,F as O,f as se,z as b,g as y,E as o,i as p,t as u,l as m,M as S,T as ae,U as ne,H as V,h as N,J as D,V as k}from"./index-6cadf62f.js";const oe={class:"orders-page"},re={class:"container"},le={class:"order-filters"},ie={class:"orders-container"},ce={key:0,class:"empty-state"},ue={key:1,class:"orders-list"},de={class:"order-header"},pe={class:"order-info"},_e={class:"order-no"},me={class:"order-date"},ge={class:"order-content"},fe={class:"resource-info"},ye=["src","alt"],ve={class:"resource-details"},ke={class:"order-amount"},Ce={class:"amount-item"},he={class:"amount-item"},we={class:"amount-total"},$e={class:"order-actions"},xe={key:0,class:"pagination-container"},Te={__name:"Orders",setup(Oe){const E=W(),j=X(),C=U(!1),z=U([]),h=U("all"),i=Y({page:1,limit:10,total:0}),_=async()=>{try{C.value=!0;const s={page:i.page,limit:i.limit};h.value!=="all"&&(s.status=h.value);const e=await y.get("/orders",{params:s});e.data.status==="success"&&(z.value=e.data.data.orders,Object.assign(i,e.data.data.pagination))}catch(s){console.error("获取订单列表失败:",s),o.error("获取订单列表失败")}finally{C.value=!1}},M=()=>{i.page=1,_()},A=()=>{_()},P=()=>{i.page=1,_()},F=s=>{if(!s)return"/images/placeholder.jpg";if(Array.isArray(s))return s.length>0?D(s[0]):"/images/placeholder.jpg";try{const e=JSON.parse(s);return e.length>0?D(e[0]):"/images/placeholder.jpg"}catch{return"/images/placeholder.jpg"}},I=async s=>{try{await k.confirm("确定要取消这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await y.put(`/orders/${s}/status`,{status:"cancelled"}),o.success("订单已取消"),_()}catch(e){e!=="cancel"&&(console.error("取消订单失败:",e),o.error("取消订单失败"))}},J=async s=>{try{await k.confirm("确认已完成此次租赁吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"info"}),await y.put(`/orders/${s}/status`,{status:"completed"}),o.success("订单已完成"),_()}catch(e){e!=="cancel"&&(console.error("完成订单失败:",e),o.error("完成订单失败"))}},B=s=>j.user&&j.user.id===s.owner_id,R=async s=>{try{await k.confirm("确认接受这个租赁订单吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}),await y.put(`/orders/${s}/status`,{status:"confirmed"}),o.success("订单已确认"),_()}catch(e){e!=="cancel"&&(console.error("确认订单失败:",e),o.error("确认订单失败"))}},q=async s=>{try{await k.confirm("确定要拒绝这个订单吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await y.put(`/orders/${s}/status`,{status:"cancelled"}),o.success("订单已拒绝"),_()}catch(e){e!=="cancel"&&(console.error("拒绝订单失败:",e),o.error("拒绝订单失败"))}},H=async s=>{try{await k.confirm("确认开始租赁吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"info"}),await y.put(`/orders/${s}/status`,{status:"ongoing"}),o.success("租赁已开始"),_()}catch(e){e!=="cancel"&&(console.error("开始租赁失败:",e),o.error("开始租赁失败"))}},L=async s=>{try{const e=B(s),g=e?s.renter_id:s.owner_id,w=e?s.renter_name:s.owner_name,c=e?"租客":"房东",$=await y.get(`/users/${g}`);if($.data.status==="success"){const x=$.data.data.user,T=x.phone||x.email;T?k.alert(`${w}的联系方式：${T}`,`联系${c}`,{confirmButtonText:"知道了",type:"info"}):o.info(`${w}暂未设置联系方式`)}else o.error("获取联系方式失败")}catch(e){console.error("获取联系方式失败:",e),o.error("获取联系方式失败")}},G=s=>{E.push(`/orders/${s}`)};return Z(()=>{_()}),(s,e)=>{const g=v("el-tab-pane"),w=v("el-tabs"),c=v("el-button"),$=v("el-empty"),x=v("el-tag"),T=v("el-pagination"),K=ee("loading");return r(),d("div",oe,[a("div",re,[e[15]||(e[15]=a("div",{class:"page-header"},[a("h1",null,"我的订单"),a("p",null,"管理您的租赁订单")],-1)),a("div",le,[n(w,{modelValue:h.value,"onUpdate:modelValue":e[0]||(e[0]=t=>h.value=t),onTabChange:M},{default:l(()=>[n(g,{label:"全部订单",name:"all"}),n(g,{label:"待确认",name:"pending"}),n(g,{label:"进行中",name:"ongoing"}),n(g,{label:"已完成",name:"completed"}),n(g,{label:"已取消",name:"cancelled"})]),_:1},8,["modelValue"])]),te((r(),d("div",ie,[z.value.length===0&&!C.value?(r(),d("div",ce,[n($,{description:"暂无订单"},{default:l(()=>[n(c,{type:"primary",onClick:e[1]||(e[1]=t=>s.$router.push("/resources"))},{default:l(()=>e[4]||(e[4]=[p(" 去找物品 ")])),_:1,__:[4]})]),_:1})])):(r(),d("div",ue,[(r(!0),d(O,null,se(z.value,t=>(r(),d("div",{key:t.id,class:"order-card"},[a("div",de,[a("div",pe,[a("span",_e,"订单号："+u(t.order_no),1),a("span",me,u(m(S)(t.created_at)),1)]),n(x,{type:m(ne)(t.status)},{default:l(()=>[p(u(m(ae)(t.status)),1)]),_:2},1032,["type"])]),a("div",ge,[a("div",fe,[a("img",{src:F(t.resource_images),alt:t.resource_title,class:"resource-image"},null,8,ye),a("div",ve,[a("h3",null,u(t.resource_title),1),a("p",null,"租赁时间："+u(m(S)(t.start_date))+" 至 "+u(m(S)(t.end_date)),1),a("p",null,"租赁天数："+u(t.days)+" 天",1)])]),a("div",ke,[a("div",Ce,[e[5]||(e[5]=a("span",null,"日租金：",-1)),a("span",null,"¥"+u(m(V)(t.daily_price)),1)]),a("div",he,[e[6]||(e[6]=a("span",null,"押金：",-1)),a("span",null,"¥"+u(m(V)(t.deposit)),1)]),a("div",we,[e[7]||(e[7]=a("span",null,"总计：",-1)),a("span",null,"¥"+u(m(V)(t.total_price)),1)])])]),a("div",$e,[t.status==="pending"?(r(),d(O,{key:0},[B(t)?(r(),d(O,{key:0},[n(c,{type:"primary",size:"small",onClick:f=>R(t.id)},{default:l(()=>e[8]||(e[8]=[p(" 确认订单 ")])),_:2,__:[8]},1032,["onClick"]),n(c,{type:"danger",size:"small",onClick:f=>q(t.id)},{default:l(()=>e[9]||(e[9]=[p(" 拒绝订单 ")])),_:2,__:[9]},1032,["onClick"])],64)):(r(),N(c,{key:1,type:"danger",size:"small",onClick:f=>I(t.id)},{default:l(()=>e[10]||(e[10]=[p(" 取消订单 ")])),_:2,__:[10]},1032,["onClick"]))],64)):b("",!0),t.status==="confirmed"?(r(),d(O,{key:1},[n(c,{type:"success",size:"small",onClick:f=>H(t.id)},{default:l(()=>e[11]||(e[11]=[p(" 开始租赁 ")])),_:2,__:[11]},1032,["onClick"]),n(c,{type:"danger",size:"small",onClick:f=>I(t.id)},{default:l(()=>e[12]||(e[12]=[p(" 取消订单 ")])),_:2,__:[12]},1032,["onClick"])],64)):b("",!0),t.status==="ongoing"?(r(),N(c,{key:2,type:"success",size:"small",onClick:f=>J(t.id)},{default:l(()=>e[13]||(e[13]=[p(" 确认完成 ")])),_:2,__:[13]},1032,["onClick"])):b("",!0),n(c,{size:"small",type:"info",onClick:f=>L(t)},{default:l(()=>[p(u(B(t)?"联系租客":"联系房东"),1)]),_:2},1032,["onClick"]),n(c,{size:"small",onClick:f=>G(t.id)},{default:l(()=>e[14]||(e[14]=[p(" 查看详情 ")])),_:2,__:[14]},1032,["onClick"])])]))),128))]))])),[[K,C.value]]),i.total>0?(r(),d("div",xe,[n(T,{"current-page":i.page,"onUpdate:currentPage":e[2]||(e[2]=t=>i.page=t),"page-size":i.limit,"onUpdate:pageSize":e[3]||(e[3]=t=>i.limit=t),total:i.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:P,onCurrentChange:A},null,8,["current-page","page-size","total"])])):b("",!0)])])}}},ze=Q(Te,[["__scopeId","data-v-0566986d"]]);export{ze as default};
