import{_ as h,p as q,u as G,I as K,r as U,D as j,o as Q,a as _,b as d,c as p,d as s,e as o,w as r,g as $,E as v,i,l as u,U as W,t as n,T as X,M as b,H as D,O as V,h as y,z as f,F as x,J as A,V as E}from"./index-6cadf62f.js";const Z={class:"order-detail-page"},ee={class:"container"},se={class:"page-header"},te={key:0,class:"loading"},re={key:1,class:"order-detail"},ae={class:"card-header"},oe={class:"order-info"},le={class:"info-row"},ne={class:"value"},de={class:"info-row"},ie={class:"value"},ue={class:"info-row"},ce={class:"value"},_e={class:"info-row"},pe={class:"value"},ve={class:"info-row"},fe={class:"value"},me={class:"resource-info"},ye={class:"resource-image"},ge=["src","alt"],ke={class:"resource-details"},we={class:"price-info"},Ce={class:"price-row"},Oe={class:"price"},$e={class:"price-row"},be={class:"price"},De={class:"price-row total"},xe={class:"price"},Be={class:"users-info"},Ie={class:"user-item"},Se={class:"user-details"},ze={class:"username"},Me={class:"user-item"},Ne={class:"user-details"},Ue={class:"username"},je={class:"order-actions"},Ve={key:2,class:"error-state"},Ae={__name:"OrderDetail",setup(Ee){const R=q();G();const g=K(),O=U(!0),t=U(null),B=j(()=>g.user&&t.value&&g.user.id===t.value.owner_id),T=j(()=>g.user&&t.value&&g.user.id===t.value.renter_id),Y=a=>{if(!a)return"/images/placeholder.jpg";if(Array.isArray(a))return a.length>0?A(a[0]):"/images/placeholder.jpg";try{const e=JSON.parse(a);return e.length>0?A(e[0]):"/images/placeholder.jpg"}catch{return"/images/placeholder.jpg"}},I=async()=>{try{O.value=!0;const a=R.params.id,e=await $.get(`/orders/${a}`);e.data.status==="success"?t.value=e.data.data.order:v.error("获取订单详情失败")}catch(a){console.error("获取订单详情失败:",a),v.error("获取订单详情失败")}finally{O.value=!1}},m=async(a,e)=>{try{await E.confirm(e,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await $.put(`/orders/${t.value.id}/status`,{status:a}),v.success("操作成功"),await I()}catch(l){l!=="cancel"&&(console.error("操作失败:",l),v.error("操作失败"))}},S=async a=>{try{const e=a==="owner"?t.value.owner_id:t.value.renter_id,l=a==="owner"?t.value.owner_name:t.value.renter_name,k=await $.get(`/users/${e}`);if(k.data.status==="success"){const w=k.data.data.user,c=w.phone||w.email;c?E.alert(`${l}的联系方式：${c}`,`联系${a==="owner"?"房东":"租客"}`,{confirmButtonText:"知道了",type:"info"}):v.info(`${l}暂未设置联系方式`)}else v.error("获取联系方式失败")}catch(e){console.error("获取联系方式失败:",e),v.error("获取联系方式失败")}},H=()=>m("confirmed","确认接受这个租赁订单吗？"),F=()=>m("cancelled","确定要拒绝这个订单吗？"),z=()=>m("cancelled","确定要取消这个订单吗？"),J=()=>m("ongoing","确认开始租赁吗？"),L=()=>m("completed","确认已完成此次租赁吗？");return Q(()=>{I()}),(a,e)=>{const l=_("el-button"),k=_("el-skeleton"),w=_("el-tag"),c=_("el-card"),M=_("el-icon"),N=_("el-avatar"),P=_("el-empty");return d(),p("div",Z,[s("div",ee,[s("div",se,[o(l,{onClick:e[0]||(e[0]=C=>a.$router.back()),icon:"ArrowLeft"},{default:r(()=>e[5]||(e[5]=[i("返回")])),_:1,__:[5]}),e[6]||(e[6]=s("h1",null,"订单详情",-1))]),O.value?(d(),p("div",te,[o(k,{rows:8,animated:""})])):t.value?(d(),p("div",re,[o(c,{class:"order-info-card"},{header:r(()=>[s("div",ae,[e[7]||(e[7]=s("span",null,"订单信息",-1)),o(w,{type:u(W)(t.value.status),size:"large"},{default:r(()=>[i(n(u(X)(t.value.status)),1)]),_:1},8,["type"])])]),default:r(()=>[s("div",oe,[s("div",le,[e[8]||(e[8]=s("span",{class:"label"},"订单号：",-1)),s("span",ne,n(t.value.order_no),1)]),s("div",de,[e[9]||(e[9]=s("span",{class:"label"},"下单时间：",-1)),s("span",ie,n(u(b)(t.value.created_at,"YYYY-MM-DD HH:mm:ss")),1)]),s("div",ue,[e[10]||(e[10]=s("span",{class:"label"},"租赁时间：",-1)),s("span",ce,n(u(b)(t.value.start_date))+" 至 "+n(u(b)(t.value.end_date)),1)]),s("div",_e,[e[11]||(e[11]=s("span",{class:"label"},"租赁天数：",-1)),s("span",pe,n(t.value.days)+" 天",1)]),s("div",ve,[e[12]||(e[12]=s("span",{class:"label"},"备注：",-1)),s("span",fe,n(t.value.remark||"无"),1)])])]),_:1}),o(c,{class:"resource-info-card"},{header:r(()=>e[13]||(e[13]=[s("span",null,"租赁物品",-1)])),default:r(()=>[s("div",me,[s("div",ye,[s("img",{src:Y(t.value.resource_images),alt:t.value.resource_title},null,8,ge)]),s("div",ke,[s("h3",null,n(t.value.resource_title),1),s("div",we,[s("div",Ce,[e[14]||(e[14]=s("span",{class:"label"},"日租金：",-1)),s("span",Oe,"¥"+n(u(D)(t.value.daily_price)),1)]),s("div",$e,[e[15]||(e[15]=s("span",{class:"label"},"押金：",-1)),s("span",be,"¥"+n(u(D)(t.value.deposit)),1)]),s("div",De,[e[16]||(e[16]=s("span",{class:"label"},"总计：",-1)),s("span",xe,"¥"+n(u(D)(t.value.total_price)),1)])])])])]),_:1}),o(c,{class:"users-info-card"},{header:r(()=>e[17]||(e[17]=[s("span",null,"参与用户",-1)])),default:r(()=>[s("div",Be,[s("div",Ie,[e[19]||(e[19]=s("div",{class:"user-role"},"租客",-1)),s("div",Se,[o(N,{src:t.value.renter_avatar,size:40},{default:r(()=>[o(M,null,{default:r(()=>[o(u(V))]),_:1})]),_:1},8,["src"]),s("span",ze,n(t.value.renter_name),1),T.value?f("",!0):(d(),y(l,{key:0,size:"small",type:"primary",onClick:e[1]||(e[1]=C=>S("renter"))},{default:r(()=>e[18]||(e[18]=[i(" 联系租客 ")])),_:1,__:[18]}))])]),s("div",Me,[e[21]||(e[21]=s("div",{class:"user-role"},"房东",-1)),s("div",Ne,[o(N,{src:t.value.owner_avatar,size:40},{default:r(()=>[o(M,null,{default:r(()=>[o(u(V))]),_:1})]),_:1},8,["src"]),s("span",Ue,n(t.value.owner_name),1),B.value?f("",!0):(d(),y(l,{key:0,size:"small",type:"primary",onClick:e[2]||(e[2]=C=>S("owner"))},{default:r(()=>e[20]||(e[20]=[i(" 联系房东 ")])),_:1,__:[20]}))])])])]),_:1}),o(c,{class:"order-actions-card"},{header:r(()=>e[22]||(e[22]=[s("span",null,"订单操作",-1)])),default:r(()=>[s("div",je,[t.value.status==="pending"?(d(),p(x,{key:0},[B.value?(d(),p(x,{key:0},[o(l,{type:"primary",onClick:H},{default:r(()=>e[23]||(e[23]=[i("确认订单")])),_:1,__:[23]}),o(l,{type:"danger",onClick:F},{default:r(()=>e[24]||(e[24]=[i("拒绝订单")])),_:1,__:[24]})],64)):(d(),y(l,{key:1,type:"danger",onClick:z},{default:r(()=>e[25]||(e[25]=[i("取消订单")])),_:1,__:[25]}))],64)):f("",!0),t.value.status==="confirmed"?(d(),p(x,{key:1},[o(l,{type:"success",onClick:J},{default:r(()=>e[26]||(e[26]=[i("开始租赁")])),_:1,__:[26]}),o(l,{type:"danger",onClick:z},{default:r(()=>e[27]||(e[27]=[i("取消订单")])),_:1,__:[27]})],64)):f("",!0),t.value.status==="ongoing"?(d(),y(l,{key:2,type:"success",onClick:L},{default:r(()=>e[28]||(e[28]=[i("确认完成")])),_:1,__:[28]})):f("",!0),["completed","cancelled"].includes(t.value.status)?(d(),y(l,{key:3,onClick:e[3]||(e[3]=C=>a.$router.push("/orders"))},{default:r(()=>e[29]||(e[29]=[i("返回订单列表")])),_:1,__:[29]})):f("",!0)])]),_:1})])):(d(),p("div",Ve,[o(P,{description:"订单不存在或已被删除"},{default:r(()=>[o(l,{type:"primary",onClick:e[4]||(e[4]=C=>a.$router.push("/orders"))},{default:r(()=>e[30]||(e[30]=[i("返回订单列表")])),_:1,__:[30]})]),_:1})]))])])}}},Te=h(Ae,[["__scopeId","data-v-ac4ee1ab"]]);export{Te as default};
