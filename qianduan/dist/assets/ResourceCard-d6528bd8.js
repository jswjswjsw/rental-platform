import{_ as B,I as E,r as M,o as L,a as v,b as h,c as y,F as R,d as e,k as w,t as o,e as t,w as r,l as c,N as b,R as k,m as F,i as m,H as I,O as $,K as j,M as O,J as N,Q as T,g as p,E as f}from"./index-6cadf62f.js";const D={class:"card-image"},J=["src","alt"],q={class:"card-actions"},H={class:"card-content"},K={class:"card-title"},P={class:"card-location"},Q={class:"card-meta"},G={class:"card-price"},W={class:"price"},X={class:"card-rating"},Y={class:"card-footer"},Z={class:"owner-info"},ee={class:"card-stats"},se={class:"list-image"},te=["src","alt"],ae={class:"list-content"},le={class:"list-header"},oe={class:"list-title"},re={class:"list-price"},ie={class:"price"},ce={class:"list-description"},ne={class:"list-meta"},de={class:"meta-item"},ue={class:"meta-item"},ve={class:"meta-item"},me={class:"meta-item"},fe={class:"list-footer"},_e={class:"list-time"},ge={class:"list-actions"},he={__name:"ResourceCard",props:{resource:{type:Object,required:!0},viewMode:{type:String,default:"grid"}},emits:["click"],setup(s,{emit:ye}){const _=s,C=E(),n=M(!1),d=M(!1),V=l=>{if(!l)return"/images/placeholder.jpg";if(Array.isArray(l))return l.length>0?N(l[0]):"/images/placeholder.jpg";try{const a=JSON.parse(l);return a.length>0?N(a[0]):"/images/placeholder.jpg"}catch{return"/images/placeholder.jpg"}},x=l=>T(l),U=async()=>{if(C.isLoggedIn)try{const l=await p.get(`/favorites/check/${_.resource.id}`);l.data.status==="success"&&(n.value=l.data.data.isFavorited)}catch(l){console.error("检查收藏状态失败:",l)}},S=async()=>{var l,a;if(!C.isLoggedIn){f.warning("请先登录后再收藏");return}if(!d.value)try{d.value=!0,n.value?(await p.delete(`/favorites/${_.resource.id}`),n.value=!1,f.success("取消收藏成功")):(await p.post("/favorites",{resource_id:_.resource.id}),n.value=!0,f.success("收藏成功"))}catch(i){console.error("收藏操作失败:",i),f.error(((a=(l=i.response)==null?void 0:l.data)==null?void 0:a.message)||"操作失败")}finally{d.value=!1}};return L(()=>{U()}),(l,a)=>{const i=v("el-icon"),g=v("el-button"),z=v("el-rate"),A=v("el-avatar");return h(),y("div",{class:w(["resource-card",s.viewMode]),onClick:a[3]||(a[3]=u=>l.$emit("click"))},[s.viewMode==="grid"?(h(),y(R,{key:0},[e("div",D,[e("img",{src:V(s.resource.images),alt:s.resource.title},null,8,J),e("div",{class:w(["card-status",s.resource.status])},o(x(s.resource.status)),3),e("div",q,[t(g,{circle:"",size:"small",type:n.value?"warning":"default",loading:d.value,onClick:k(S,["stop"])},{default:r(()=>[t(i,null,{default:r(()=>[t(c(b),{filled:n.value},null,8,["filled"])]),_:1})]),_:1},8,["type","loading"])])]),e("div",H,[e("h3",K,o(s.resource.title),1),e("p",P,[t(i,null,{default:r(()=>[t(c(F))]),_:1}),m(" "+o(s.resource.location||"位置未知"),1)]),e("div",Q,[e("div",G,[e("span",W,"¥"+o(c(I)(s.resource.price_per_day)),1),a[4]||(a[4]=e("span",{class:"unit"},"/天",-1))]),e("div",X,[t(z,{modelValue:s.resource.rating,"onUpdate:modelValue":a[0]||(a[0]=u=>s.resource.rating=u),disabled:"",size:"small","show-score":"","text-color":"#ff9900","score-template":"{value}"},null,8,["modelValue"])])]),e("div",Y,[e("div",Z,[t(A,{src:s.resource.owner_avatar,size:24},{default:r(()=>[t(i,null,{default:r(()=>[t(c($))]),_:1})]),_:1},8,["src"]),e("span",null,o(s.resource.owner_name),1)]),e("div",ee,[e("span",null,[t(i,null,{default:r(()=>[t(c(j))]),_:1}),m(" "+o(s.resource.view_count||0),1)])])])])],64)):(h(),y(R,{key:1},[e("div",se,[e("img",{src:V(s.resource.images),alt:s.resource.title},null,8,te),e("div",{class:w(["list-status",s.resource.status])},o(x(s.resource.status)),3)]),e("div",ae,[e("div",le,[e("h3",oe,o(s.resource.title),1),e("div",re,[e("span",ie,"¥"+o(c(I)(s.resource.price_per_day)),1),a[5]||(a[5]=e("span",{class:"unit"},"/天",-1))])]),e("p",ce,o(s.resource.description||"暂无描述"),1),e("div",ne,[e("div",de,[t(i,null,{default:r(()=>[t(c(F))]),_:1}),e("span",null,o(s.resource.location||"位置未知"),1)]),e("div",ue,[t(i,null,{default:r(()=>[t(c($))]),_:1}),e("span",null,o(s.resource.owner_name),1)]),e("div",ve,[t(i,null,{default:r(()=>[t(c(j))]),_:1}),e("span",null,o(s.resource.view_count||0)+" 次浏览",1)]),e("div",me,[t(z,{modelValue:s.resource.rating,"onUpdate:modelValue":a[1]||(a[1]=u=>s.resource.rating=u),disabled:"",size:"small","show-score":"","text-color":"#ff9900","score-template":"{value} 分"},null,8,["modelValue"])])]),e("div",fe,[e("div",_e," 发布于 "+o(c(O)(s.resource.created_at)),1),e("div",ge,[t(g,{size:"small",type:n.value?"warning":"default",loading:d.value,onClick:k(S,["stop"])},{default:r(()=>[t(i,null,{default:r(()=>[t(c(b),{filled:n.value},null,8,["filled"])]),_:1}),m(" "+o(n.value?"已收藏":"收藏"),1)]),_:1},8,["type","loading"]),t(g,{type:"primary",size:"small",onClick:a[2]||(a[2]=k(u=>l.$emit("click"),["stop"]))},{default:r(()=>a[6]||(a[6]=[m(" 查看详情 ")])),_:1,__:[6]})])])])],64))],2)}}},ke=B(he,[["__scopeId","data-v-7fe8d8e5"]]);export{ke as R};
