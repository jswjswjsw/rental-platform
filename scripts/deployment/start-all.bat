::
:: é—²ç½®èµ„æºç§Ÿèµå¹³å°ä¸€é”®å¯åŠ¨è„šæœ¬
:: 
:: åŠŸèƒ½è¯´æ˜Žï¼š
:: - è‡ªåŠ¨æ£€æŸ¥Node.jsè¿è¡ŒçŽ¯å¢ƒ
:: - è‡ªåŠ¨å®‰è£…å‰åŽç«¯é¡¹ç›®ä¾èµ–
:: - åŒæ—¶å¯åŠ¨å‰ç«¯å’ŒåŽç«¯æœåŠ¡
:: - æä¾›æœåŠ¡çŠ¶æ€å’Œè®¿é—®åœ°å€ä¿¡æ¯
:: 
:: ä½¿ç”¨æ–¹æ³•ï¼š
:: 1. åŒå‡»è¿è¡Œæ­¤è„šæœ¬æ–‡ä»¶
:: 2. æˆ–åœ¨å‘½ä»¤è¡Œä¸­æ‰§è¡Œï¼šstart-all.bat
:: 
:: æœåŠ¡åœ°å€ï¼š
:: - å‰ç«¯åº”ç”¨ï¼šhttp://localhost:8080
:: - åŽç«¯APIï¼šhttp://localhost:3000
:: - APIæ–‡æ¡£ï¼šhttp://localhost:3000/api/health
:: 
:: æ³¨æ„äº‹é¡¹ï¼š
:: - ç¡®ä¿å·²å®‰è£…Node.js (ç‰ˆæœ¬ >= 14.0.0)
:: - ç¡®ä¿å·²é…ç½®MySQLæ•°æ®åº“
:: - ç¡®ä¿åŽç«¯.envæ–‡ä»¶é…ç½®æ­£ç¡®
:: - é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨å®‰è£…ä¾èµ–åŒ…
:: 
:: @author å¼€å‘å›¢é˜Ÿ
:: @version 1.0.0
:: @since 2024-01-01
::

@echo off
:: è®¾ç½®æŽ§åˆ¶å°ç¼–ç ä¸ºUTF-8
chcp 65001 >nul

echo.
echo ==========================================
echo   é—²ç½®èµ„æºç§Ÿèµå¹³å° - ä¸€é”®å¯åŠ¨è„šæœ¬
echo ==========================================
echo.

:: ==================== çŽ¯å¢ƒæ£€æŸ¥ ====================

echo [1/5] æ£€æŸ¥Node.jsè¿è¡ŒçŽ¯å¢ƒ...
node --version >nul 2>&1
if errorlevel 1 (
    echo âŒ é”™è¯¯: æœªæ‰¾åˆ°Node.jsè¿è¡ŒçŽ¯å¢ƒ
    echo.
    echo è¯·å…ˆå®‰è£…Node.js (æŽ¨èç‰ˆæœ¬ >= 16.0.0):
    echo https://nodejs.org/
    echo.
    pause
    exit /b 1
) else (
    for /f "tokens=*" %%i in ('node --version') do set NODE_VERSION=%%i
    echo âœ… Node.jsçŽ¯å¢ƒæ£€æŸ¥é€šè¿‡: %NODE_VERSION%
)

echo.

:: ==================== åŽç«¯æœåŠ¡å¯åŠ¨ ====================

echo [2/5] å‡†å¤‡å¯åŠ¨åŽç«¯æœåŠ¡...
cd /d "%~dp0houduan"

:: æ£€æŸ¥å¹¶å®‰è£…åŽç«¯ä¾èµ–
if not exist node_modules (
    echo ðŸ“¦ æ­£åœ¨å®‰è£…åŽç«¯ä¾èµ–åŒ…...
    call npm install
    if errorlevel 1 (
        echo âŒ åŽç«¯ä¾èµ–å®‰è£…å¤±è´¥
        pause
        exit /b 1
    )
    echo âœ… åŽç«¯ä¾èµ–å®‰è£…å®Œæˆ
) else (
    echo âœ… åŽç«¯ä¾èµ–å·²å­˜åœ¨
)

:: æ£€æŸ¥çŽ¯å¢ƒé…ç½®æ–‡ä»¶
if not exist .env (
    echo âš ï¸  è­¦å‘Š: æœªæ‰¾åˆ°.envé…ç½®æ–‡ä»¶
    echo è¯·ç¡®ä¿å·²æ­£ç¡®é…ç½®æ•°æ®åº“è¿žæŽ¥ä¿¡æ¯
    echo.
)

:: å¯åŠ¨åŽç«¯æœåŠ¡
echo ðŸš€ å¯åŠ¨åŽç«¯æœåŠ¡...
start "é—²ç½®ç§Ÿèµå¹³å°-åŽç«¯æœåŠ¡" cmd /k "echo åŽç«¯æœåŠ¡å¯åŠ¨ä¸­... && npm run dev"

echo.

:: ==================== å‰ç«¯æœåŠ¡å¯åŠ¨ ====================

echo [3/5] å‡†å¤‡å¯åŠ¨å‰ç«¯æœåŠ¡...
cd /d "%~dp0qianduan"

:: æ£€æŸ¥å¹¶å®‰è£…å‰ç«¯ä¾èµ–
if not exist node_modules (
    echo ðŸ“¦ æ­£åœ¨å®‰è£…å‰ç«¯ä¾èµ–åŒ…...
    call npm install
    if errorlevel 1 (
        echo âŒ å‰ç«¯ä¾èµ–å®‰è£…å¤±è´¥
        pause
        exit /b 1
    )
    echo âœ… å‰ç«¯ä¾èµ–å®‰è£…å®Œæˆ
) else (
    echo âœ… å‰ç«¯ä¾èµ–å·²å­˜åœ¨
)

:: å¯åŠ¨å‰ç«¯æœåŠ¡
echo ðŸš€ å¯åŠ¨å‰ç«¯æœåŠ¡...
start "é—²ç½®ç§Ÿèµå¹³å°-å‰ç«¯æœåŠ¡" cmd /k "echo å‰ç«¯æœåŠ¡å¯åŠ¨ä¸­... && npm run dev"

echo.

:: ==================== å¯åŠ¨å®Œæˆä¿¡æ¯ ====================

echo [4/5] æœåŠ¡å¯åŠ¨å®Œæˆï¼
echo.
echo ðŸ“ æœåŠ¡è®¿é—®åœ°å€ï¼š
echo   â”Œâ”€ å‰ç«¯åº”ç”¨: http://localhost:8080
echo   â”œâ”€ åŽç«¯API:  http://localhost:3000/api
echo   â””â”€ å¥åº·æ£€æŸ¥: http://localhost:3000/api/health
echo.
echo ðŸ“‹ ä½¿ç”¨è¯´æ˜Žï¼š
echo   â€¢ å‰ç«¯æœåŠ¡é€šå¸¸éœ€è¦1-2åˆ†é’Ÿå®Œå…¨å¯åŠ¨
echo   â€¢ åŽç«¯æœåŠ¡å¯åŠ¨åŽä¼šè‡ªåŠ¨è¿žæŽ¥æ•°æ®åº“
echo   â€¢ å¦‚é‡é—®é¢˜è¯·æ£€æŸ¥æŽ§åˆ¶å°é”™è¯¯ä¿¡æ¯
echo   â€¢ æŒ‰Ctrl+Cå¯åœæ­¢å¯¹åº”æœåŠ¡
echo.

echo [5/5] ç­‰å¾…æœåŠ¡å®Œå…¨å¯åŠ¨...
echo æ­£åœ¨ç­‰å¾…æœåŠ¡å¯åŠ¨å®Œæˆï¼Œè¯·ç¨å€™...
timeout /t 3 >nul

echo.
echo âœ… å¯åŠ¨è„šæœ¬æ‰§è¡Œå®Œæˆï¼
echo è¯·æŸ¥çœ‹æ–°æ‰“å¼€çš„çª—å£äº†è§£æœåŠ¡çŠ¶æ€
echo.
echo æŒ‰ä»»æ„é”®å…³é—­æ­¤çª—å£...
pause >nul