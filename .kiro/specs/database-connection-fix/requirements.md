# 数据库连接和Favorites表修复需求文档

## 项目背景

租赁平台在运行过程中遇到了数据库连接问题，主要表现为：
1. 前端显示"网络连接失败"
2. 后端日志显示"Table 'rental_platform.favorites' doesn't exist"错误
3. 图片上传功能无法正常工作
4. 用户收藏功能报错

## 需求概述

需要修复数据库连接问题，确保favorites表正确创建，并恢复所有相关功能的正常运行。

## 功能需求

### 需求1：数据库连接修复

**用户故事：** 作为系统管理员，我希望后端服务能够稳定连接到阿里云RDS数据库，以便系统正常运行。

#### 验收标准
1. WHEN 后端服务启动 THEN 应该能成功连接到RDS数据库
2. WHEN 执行数据库查询 THEN 不应该出现权限拒绝错误
3. WHEN 查看后端日志 THEN 应该显示"阿里云RDS连接成功"
4. WHEN 访问健康检查接口 THEN 应该返回正常状态

### 需求2：Favorites表创建和验证

**用户故事：** 作为开发者，我希望favorites表能够正确创建并可用，以便用户收藏功能正常工作。

#### 验收标准
1. WHEN 检查数据库表 THEN favorites表应该存在
2. WHEN 执行收藏相关查询 THEN 不应该出现"表不存在"错误
3. WHEN 用户尝试收藏资源 THEN 操作应该成功执行
4. WHEN 查看表结构 THEN 应该包含所有必需的字段和索引

### 需求3：图片上传功能修复

**用户故事：** 作为用户，我希望能够正常上传和查看图片，以便完整使用平台功能。

#### 验收标准
1. WHEN 用户上传图片 THEN 图片应该成功保存到服务器
2. WHEN 访问图片URL THEN 应该能正常显示图片
3. WHEN 检查uploads目录 THEN 应该存在resources和avatars子目录
4. WHEN 发布资源时上传图片 THEN 图片应该正确关联到资源

### 需求4：前端网络连接修复

**用户故事：** 作为用户，我希望前端页面能够正常加载和使用，不出现网络连接错误。

#### 验收标准
1. WHEN 访问前端页面 THEN 应该正常加载
2. WHEN 前端调用后端API THEN 应该能成功获取响应
3. WHEN 用户进行操作 THEN 不应该显示"服务器内部错误"
4. WHEN 查看浏览器控制台 THEN 不应该有网络请求失败的错误

## 技术约束

1. **数据库环境**：阿里云RDS MySQL 8.0
2. **服务器环境**：阿里云ECS Windows Server
3. **现有配置**：不能破坏现有的数据和配置
4. **向下兼容**：修复过程中不能影响现有功能

## 验收标准

### 系统级验收标准
1. 所有服务（前端、后端）状态为online
2. 数据库连接稳定，无权限错误
3. 所有API接口正常响应
4. 图片上传和显示功能正常
5. 用户收藏功能正常工作

### 性能标准
1. 数据库连接响应时间 < 2秒
2. API接口响应时间 < 3秒
3. 图片上传成功率 > 95%

## 风险评估

### 高风险
- 数据库权限配置错误可能导致数据丢失
- 不当的表结构修改可能影响现有数据

### 中风险
- 服务重启可能导致短暂的服务中断
- 配置文件修改错误可能导致服务无法启动

### 缓解措施
- 在修改前备份所有配置文件
- 分步骤执行，每步验证结果
- 保留回滚方案