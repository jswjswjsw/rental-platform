import{_ as E,u as L,r as c,q as R,o as N,a as n,b,c as x,d as a,e as l,w as r,g as w,E as u,F as Q,f as S,h as T,l as j,S as W,i as I}from"./index-05c20d45.js";const A={class:"publish-page"},G={class:"container"},H={class:"publish-form-container"},J={class:"form-section"},K={class:"form-section"},O={class:"form-section"},X={class:"form-section"},Y={class:"form-actions"},Z={__name:"Publish",setup($){const h=L(),p=c(),g=c(!1),y=c([]),f=c([]),t=R({categoryId:null,title:"",description:"",pricePerDay:null,deposit:0,location:"",contactInfo:"",images:[]}),P={categoryId:[{required:!0,message:"请选择物品分类",trigger:"change"}],title:[{required:!0,message:"请输入物品标题",trigger:"blur"},{min:2,max:100,message:"标题长度在2-100个字符",trigger:"blur"}],description:[{max:500,message:"描述不能超过500个字符",trigger:"blur"}],pricePerDay:[{required:!0,message:"请输入日租金",trigger:"blur"},{type:"number",min:.01,message:"日租金必须大于0",trigger:"blur"}],deposit:[{type:"number",min:0,message:"押金不能小于0",trigger:"blur"}],location:[{max:100,message:"位置信息不能超过100个字符",trigger:"blur"}],contactInfo:[{max:200,message:"联系方式不能超过200个字符",trigger:"blur"}]},U=async()=>{try{const s=await w.get("/categories");s.data.status==="success"&&(y.value=s.data.data.categories)}catch(s){console.error("获取分类失败:",s),u.error("获取分类失败")}},D=s=>{s.status==="ready"&&t.images.push(s.raw)},k=s=>{const e=t.images.findIndex(i=>i.name===s.name);e>-1&&t.images.splice(e,1)},C=s=>{const e=s.type.startsWith("image/"),i=s.size/1024/1024<5;return e?i?!0:(u.error("图片大小不能超过5MB!"),!1):(u.error("只能上传图片文件!"),!1)},B=()=>{p.value&&p.value.resetFields(),f.value=[],t.images=[]},F=async()=>{if(p.value)try{if(!await p.value.validate())return;if(t.images.length===0){u.warning("请至少上传一张物品图片");return}g.value=!0;const e=new FormData;e.append("category_id",t.categoryId),e.append("title",t.title),e.append("description",t.description),e.append("price_per_day",t.pricePerDay),e.append("deposit",t.deposit),e.append("location",t.location),e.append("contact_info",t.contactInfo),t.images.forEach(_=>{e.append("images",_)});const i=await w.post("/resources",e,{headers:{"Content-Type":"multipart/form-data"}});i.data.status==="success"?(u.success("物品发布成功"),h.push("/resources")):u.error(i.data.message||"发布失败")}catch(s){console.error("发布物品失败:",s),u.error("发布失败，请稍后重试")}finally{g.value=!1}};return N(()=>{U()}),(s,e)=>{const i=n("el-option"),_=n("el-select"),d=n("el-form-item"),m=n("el-input"),M=n("el-icon"),q=n("el-upload"),v=n("el-input-number"),V=n("el-button"),z=n("el-form");return b(),x("div",A,[a("div",G,[e[17]||(e[17]=a("div",{class:"page-header"},[a("h1",null,"发布物品"),a("p",null,"分享您的闲置物品，让它们发挥更大价值")],-1)),a("div",H,[l(z,{ref_key:"formRef",ref:p,model:t,rules:P,"label-width":"100px",size:"large"},{default:r(()=>[a("div",J,[e[8]||(e[8]=a("h3",null,"基本信息",-1)),l(d,{label:"物品分类",prop:"categoryId"},{default:r(()=>[l(_,{modelValue:t.categoryId,"onUpdate:modelValue":e[0]||(e[0]=o=>t.categoryId=o),placeholder:"请选择物品分类",style:{width:"100%"}},{default:r(()=>[(b(!0),x(Q,null,S(y.value,o=>(b(),T(i,{key:o.id,label:o.name,value:o.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),l(d,{label:"物品标题",prop:"title"},{default:r(()=>[l(m,{modelValue:t.title,"onUpdate:modelValue":e[1]||(e[1]=o=>t.title=o),placeholder:"请输入物品标题，简洁明了",maxlength:"100","show-word-limit":""},null,8,["modelValue"])]),_:1}),l(d,{label:"物品描述",prop:"description"},{default:r(()=>[l(m,{modelValue:t.description,"onUpdate:modelValue":e[2]||(e[2]=o=>t.description=o),type:"textarea",rows:4,placeholder:"详细描述物品的特点、使用情况、注意事项等",maxlength:"500","show-word-limit":""},null,8,["modelValue"])]),_:1})]),a("div",K,[e[10]||(e[10]=a("h3",null,"物品图片",-1)),l(d,{label:"上传图片",prop:"images"},{default:r(()=>[l(q,{"file-list":f.value,"onUpdate:fileList":e[3]||(e[3]=o=>f.value=o),action:"#","list-type":"picture-card","auto-upload":!1,"on-change":D,"on-remove":k,"before-upload":C,multiple:"",limit:5},{tip:r(()=>e[9]||(e[9]=[a("div",{class:"el-upload__tip"}," 支持jpg/png格式，单张图片不超过5MB，最多上传5张 ",-1)])),default:r(()=>[l(M,null,{default:r(()=>[l(j(W))]),_:1})]),_:1},8,["file-list"])]),_:1})]),a("div",O,[e[13]||(e[13]=a("h3",null,"租赁信息",-1)),l(d,{label:"日租金",prop:"pricePerDay"},{default:r(()=>[l(v,{modelValue:t.pricePerDay,"onUpdate:modelValue":e[4]||(e[4]=o=>t.pricePerDay=o),min:.01,precision:2,step:1,style:{width:"200px"}},null,8,["modelValue"]),e[11]||(e[11]=a("span",{style:{"margin-left":"10px",color:"#666"}},"元/天",-1))]),_:1,__:[11]}),l(d,{label:"押金",prop:"deposit"},{default:r(()=>[l(v,{modelValue:t.deposit,"onUpdate:modelValue":e[5]||(e[5]=o=>t.deposit=o),min:0,precision:2,step:10,style:{width:"200px"}},null,8,["modelValue"]),e[12]||(e[12]=a("span",{style:{"margin-left":"10px",color:"#666"}},"元（可选）",-1))]),_:1,__:[12]})]),a("div",X,[e[14]||(e[14]=a("h3",null,"联系信息",-1)),l(d,{label:"物品位置",prop:"location"},{default:r(()=>[l(m,{modelValue:t.location,"onUpdate:modelValue":e[6]||(e[6]=o=>t.location=o),placeholder:"请输入物品所在位置，如：北京市朝阳区",maxlength:"100"},null,8,["modelValue"])]),_:1}),l(d,{label:"联系方式",prop:"contactInfo"},{default:r(()=>[l(m,{modelValue:t.contactInfo,"onUpdate:modelValue":e[7]||(e[7]=o=>t.contactInfo=o),type:"textarea",rows:2,placeholder:"请输入联系方式，如微信号、QQ号等（可选）",maxlength:"200"},null,8,["modelValue"])]),_:1})]),a("div",Y,[l(V,{size:"large",onClick:B},{default:r(()=>e[15]||(e[15]=[I("重置")])),_:1,__:[15]}),l(V,{type:"primary",size:"large",loading:g.value,onClick:F},{default:r(()=>e[16]||(e[16]=[I(" 发布物品 ")])),_:1,__:[16]},8,["loading"])])]),_:1},8,["model"])])])])}}},te=E(Z,[["__scopeId","data-v-bed23729"]]);export{te as default};
