import{a8 as S,a9 as M,aa as G,ab as F,_ as q,r as h,a as T,b,c as P,e as f,w as m,l as O,ac as z,i as v,t as g,F as B,f as H,d as r,ad as j,z as x,ae as I,E as w,D as W,o as J}from"./index-05c20d45.js";function K(l){l.CapacitorUtils.Synapse=new Proxy({},{get(t,s){return new Proxy({},{get(a,e){return(o,i,u)=>{const p=l.Capacitor.Plugins[s];if(p===void 0){u(new Error(`Capacitor plugin ${s} not found`));return}if(typeof p[e]!="function"){u(new Error(`Method ${e} not found in Capacitor plugin ${s}`));return}(async()=>{try{const c=await p[e](o);i(c)}catch(c){u(c)}})()}}})}})}function Q(l){l.CapacitorUtils.Synapse=new Proxy({},{get(t,s){return l.cordova.plugins[s]}})}function X(l=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!l?K(window):window.cordova!==void 0&&Q(window))}const Y=S("Geolocation",{web:()=>M(()=>import("./web-10bb03f4.js"),["assets/web-10bb03f4.js","assets/index-05c20d45.js","assets/index-4ed86ae4.css"]).then(l=>new l.GeolocationWeb)});X();const Z=S("Device",{web:()=>M(()=>import("./web-8a94da2a.js"),["assets/web-8a94da2a.js","assets/index-05c20d45.js","assets/index-4ed86ae4.css"]).then(l=>new l.DeviceWeb)}),V=S("Network",{web:()=>M(()=>import("./web-62d09ad7.js"),["assets/web-62d09ad7.js","assets/index-05c20d45.js","assets/index-4ed86ae4.css"]).then(l=>new l.NetworkWeb)});var L;(function(l){l.Prompt="PROMPT",l.Camera="CAMERA",l.Photos="PHOTOS"})(L||(L={}));var R;(function(l){l.Rear="REAR",l.Front="FRONT"})(R||(R={}));var A;(function(l){l.Uri="uri",l.Base64="base64",l.DataUrl="dataUrl"})(A||(A={}));class ee extends G{async getPhoto(t){return new Promise(async(s,a)=>{if(t.webUseInput||t.source===L.Photos)this.fileInputExperience(t,s,a);else if(t.source===L.Prompt){let e=document.querySelector("pwa-action-sheet");e||(e=document.createElement("pwa-action-sheet"),document.body.appendChild(e)),e.header=t.promptLabelHeader||"Photo",e.cancelable=!1,e.options=[{title:t.promptLabelPhoto||"From Photos"},{title:t.promptLabelPicture||"Take Picture"}],e.addEventListener("onSelection",async o=>{o.detail===0?this.fileInputExperience(t,s,a):this.cameraExperience(t,s,a)})}else this.cameraExperience(t,s,a)})}async pickImages(t){return new Promise(async(s,a)=>{this.multipleFileInputExperience(s,a)})}async cameraExperience(t,s,a){if(customElements.get("pwa-camera-modal")){const e=document.createElement("pwa-camera-modal");e.facingMode=t.direction===R.Front?"user":"environment",document.body.appendChild(e);try{await e.componentOnReady(),e.addEventListener("onPhoto",async o=>{const i=o.detail;i===null?a(new F("User cancelled photos app")):i instanceof Error?a(i):s(await this._getCameraPhoto(i,t)),e.dismiss(),document.body.removeChild(e)}),e.present()}catch{this.fileInputExperience(t,s,a)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(t,s,a)}fileInputExperience(t,s,a){let e=document.querySelector("#_capacitor-camera-input");const o=()=>{var i;(i=e.parentNode)===null||i===void 0||i.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input",e.type="file",e.hidden=!0,document.body.appendChild(e),e.addEventListener("change",i=>{const u=e.files[0];let p="jpeg";if(u.type==="image/png"?p="png":u.type==="image/gif"&&(p="gif"),t.resultType==="dataUrl"||t.resultType==="base64"){const c=new FileReader;c.addEventListener("load",()=>{if(t.resultType==="dataUrl")s({dataUrl:c.result,format:p});else if(t.resultType==="base64"){const _=c.result.split(",")[1];s({base64String:_,format:p})}o()}),c.readAsDataURL(u)}else s({webPath:URL.createObjectURL(u),format:p}),o()}),e.addEventListener("cancel",i=>{a(new F("User cancelled photos app")),o()})),e.accept="image/*",e.capture=!0,t.source===L.Photos||t.source===L.Prompt?e.removeAttribute("capture"):t.direction===R.Front?e.capture="user":t.direction===R.Rear&&(e.capture="environment"),e.click()}multipleFileInputExperience(t,s){let a=document.querySelector("#_capacitor-camera-input-multiple");const e=()=>{var o;(o=a.parentNode)===null||o===void 0||o.removeChild(a)};a||(a=document.createElement("input"),a.id="_capacitor-camera-input-multiple",a.type="file",a.hidden=!0,a.multiple=!0,document.body.appendChild(a),a.addEventListener("change",o=>{const i=[];for(let u=0;u<a.files.length;u++){const p=a.files[u];let c="jpeg";p.type==="image/png"?c="png":p.type==="image/gif"&&(c="gif"),i.push({webPath:URL.createObjectURL(p),format:c})}t({photos:i}),e()}),a.addEventListener("cancel",o=>{s(new F("User cancelled photos app")),e()})),a.accept="image/*",a.click()}_getCameraPhoto(t,s){return new Promise((a,e)=>{const o=new FileReader,i=t.type.split("/")[1];s.resultType==="uri"?a({webPath:URL.createObjectURL(t),format:i,saved:!1}):(o.readAsDataURL(t),o.onloadend=()=>{const u=o.result;s.resultType==="dataUrl"?a({dataUrl:u,format:i,saved:!1}):a({base64String:u.split(",")[1],format:i,saved:!1})},o.onerror=u=>{e(u)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const te=S("Camera",{web:()=>new ee});const ae={class:"mobile-camera"},ne={key:0,class:"photo-preview"},oe=["src","alt"],se={__name:"MobileCamera",emits:["photos-updated"],setup(l,{expose:t,emit:s}){const a=s,e=h(!1),o=h([]),i=async()=>{try{if(e.value=!0,!I.isNativePlatform()){const _=document.createElement("input");_.type="file",_.accept="image/*",_.multiple=!0,_.onchange=u,_.click();return}const c=await te.getPhoto({quality:80,allowEditing:!1,resultType:A.Uri,source:L.Camera});o.value.push({webPath:c.webPath,format:c.format}),a("photos-updated",o.value),w.success("照片添加成功")}catch(c){console.error("拍照失败:",c),w.error("拍照失败，请重试")}finally{e.value=!1}},u=c=>{const _=Array.from(c.target.files),k=["image/jpeg","image/png","image/gif","image/webp"],E=_.filter(y=>k.includes(y.type)?y.size>5*1024*1024?(w.error(`文件过大: ${y.name}`),!1):!0:(w.error(`不支持的文件类型: ${y.name}`),!1));E.forEach(y=>{const C=new FileReader;C.onload=N=>{o.value.push({webPath:N.target.result,format:y.type.split("/")[1],file:y}),a("photos-updated",o.value)},C.readAsDataURL(y)}),e.value=!1,E.length>0&&w.success(`已选择 ${E.length} 张照片`)},p=c=>{o.value.splice(c,1),a("photos-updated",o.value),w.success("照片已删除")};return t({photos:o,clearPhotos:()=>{o.value=[],a("photos-updated",o.value)}}),(c,_)=>{const k=T("el-icon"),E=T("el-button");return b(),P("div",ae,[f(E,{type:"primary",onClick:i,loading:e.value,class:"camera-button"},{default:m(()=>[f(k,null,{default:m(()=>[f(O(z))]),_:1}),v(" "+g(e.value?"拍照中...":"拍照上传"),1)]),_:1},8,["loading"]),o.value.length>0?(b(),P("div",ne,[(b(!0),P(B,null,H(o.value,(y,C)=>(b(),P("div",{key:C,class:"photo-item"},[r("img",{src:y.webPath,alt:`照片 ${C+1}`},null,8,oe),f(E,{type:"danger",size:"small",onClick:N=>p(C),class:"remove-btn"},{default:m(()=>[f(k,null,{default:m(()=>[f(O(j))]),_:1})]),_:2},1032,["onClick"])]))),128))])):x("",!0)])}}},ie=q(se,[["__scopeId","data-v-9a7f04c6"]]);const re={class:"mobile-test"},le={class:"test-header"},ce={class:"test-sections"},ue={class:"info-item"},de={class:"info-item"},pe={class:"info-item"},me={key:0,class:"photo-info"},fe={key:0,class:"location-info"},ve={key:0,class:"device-info"},ge={class:"network-status"},_e={key:0},ye={__name:"MobileTest",setup(l){const t=h({platform:"",isNative:!1}),s=h(window.innerWidth),a=h(0),e=h(null),o=h(!1),i=h(null),u=h(!1),p=h({connected:!1,connectionType:""}),c=h(null),_=W(()=>t.value.isNative?"success":"info"),k=W(()=>t.value.isNative?"移动端原生":"Web浏览器"),E=d=>{a.value=d.length},y=async()=>{try{if(o.value=!0,!I.isPluginAvailable("Geolocation"))throw new Error("地理位置功能不可用");const d=await Y.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4});e.value={latitude:d.coords.latitude.toFixed(6),longitude:d.coords.longitude.toFixed(6),accuracy:d.coords.accuracy.toFixed(0)},w.success("位置获取成功")}catch(d){console.error("获取位置失败:",d);let n="获取位置失败";d.message.includes("User denied")?n="用户拒绝了位置权限请求":d.message.includes("timeout")?n="位置获取超时，请检查GPS是否开启":d.message.includes("unavailable")&&(n="位置服务不可用"),w.error(n)}finally{o.value=!1}},C=async()=>{try{u.value=!0;const d=await Z.getInfo();i.value=d,w.success("设备信息获取成功")}catch(d){console.error("获取设备信息失败:",d),w.error("获取设备信息失败")}finally{u.value=!1}},N=async()=>{try{const d=await V.getStatus();p.value={connected:d.connected,connectionType:d.connectionType}}catch(d){console.error("获取网络状态失败:",d)}};return J(async()=>{t.value={platform:I.getPlatform(),isNative:I.isNativePlatform()},window.addEventListener("resize",()=>{s.value=window.innerWidth}),await N(),V.addListener("networkStatusChange",d=>{p.value={connected:d.connected,connectionType:d.connectionType}})}),(d,n)=>{const D=T("el-tag"),U=T("el-card"),$=T("el-button");return b(),P("div",re,[r("div",le,[n[0]||(n[0]=r("h2",null,"移动端功能测试",-1)),f(D,{type:_.value},{default:m(()=>[v(g(k.value),1)]),_:1},8,["type"])]),r("div",ce,[f(U,{class:"test-card"},{header:m(()=>n[1]||(n[1]=[r("span",null,"平台信息",-1)])),default:m(()=>[r("div",ue,[n[2]||(n[2]=r("strong",null,"平台类型:",-1)),v(" "+g(t.value.platform),1)]),r("div",de,[n[3]||(n[3]=r("strong",null,"是否原生:",-1)),v(" "+g(t.value.isNative?"是":"否"),1)]),r("div",pe,[n[4]||(n[4]=r("strong",null,"屏幕宽度:",-1)),v(" "+g(s.value)+"px ",1)])]),_:1}),f(U,{class:"test-card"},{header:m(()=>n[5]||(n[5]=[r("span",null,"相机功能",-1)])),default:m(()=>[f(ie,{onPhotosUpdated:E,ref_key:"cameraRef",ref:c},null,512),a.value>0?(b(),P("div",me," 已拍摄 "+g(a.value)+" 张照片 ",1)):x("",!0)]),_:1}),f(U,{class:"test-card"},{header:m(()=>n[6]||(n[6]=[r("span",null,"地理位置",-1)])),default:m(()=>[f($,{onClick:y,loading:o.value},{default:m(()=>n[7]||(n[7]=[v(" 获取当前位置 ")])),_:1,__:[7]},8,["loading"]),e.value?(b(),P("div",fe,[r("div",null,[n[8]||(n[8]=r("strong",null,"纬度:",-1)),v(" "+g(e.value.latitude),1)]),r("div",null,[n[9]||(n[9]=r("strong",null,"经度:",-1)),v(" "+g(e.value.longitude),1)]),r("div",null,[n[10]||(n[10]=r("strong",null,"精度:",-1)),v(" "+g(e.value.accuracy)+"m",1)])])):x("",!0)]),_:1}),f(U,{class:"test-card"},{header:m(()=>n[11]||(n[11]=[r("span",null,"设备信息",-1)])),default:m(()=>[f($,{onClick:C,loading:u.value},{default:m(()=>n[12]||(n[12]=[v(" 获取设备信息 ")])),_:1,__:[12]},8,["loading"]),i.value?(b(),P("div",ve,[r("div",null,[n[13]||(n[13]=r("strong",null,"操作系统:",-1)),v(" "+g(i.value.operatingSystem),1)]),r("div",null,[n[14]||(n[14]=r("strong",null,"平台:",-1)),v(" "+g(i.value.platform),1)]),r("div",null,[n[15]||(n[15]=r("strong",null,"是否虚拟设备:",-1)),v(" "+g(i.value.isVirtual?"是":"否"),1)])])):x("",!0)]),_:1}),f(U,{class:"test-card"},{header:m(()=>n[16]||(n[16]=[r("span",null,"网络状态",-1)])),default:m(()=>[r("div",ge,[f(D,{type:p.value.connected?"success":"danger"},{default:m(()=>[v(g(p.value.connected?"已连接":"未连接"),1)]),_:1},8,["type"]),p.value.connectionType?(b(),P("div",_e," 连接类型: "+g(p.value.connectionType),1)):x("",!0)])]),_:1})])])}}},we=q(ye,[["__scopeId","data-v-981279df"]]);export{we as default};
