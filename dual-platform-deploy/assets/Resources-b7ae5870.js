import{_ as G,u as H,p as J,r as v,q as U,s as W,o as X,a as i,v as Y,b as n,c as u,d as c,e as l,w as r,x as h,t as Z,y as ee,k as ae,F as R,f as S,z as oe,g as N,E as te,l as k,A as le,h as M,i as q,B as se,C as re}from"./index-4f31dd00.js";import{R as ie}from"./ResourceCard-d4255268.js";const ne={class:"resources-page"},ce={class:"container"},de={class:"search-section"},ue={class:"search-bar"},pe={class:"filter-bar"},me={class:"price-range"},_e={class:"result-info"},ge={class:"view-mode"},ye={class:"resources-container"},fe={key:0,class:"empty-state"},ve={key:0,class:"pagination-container"},he={__name:"Resources",setup(Ve){const x=H(),C=J(),g=v(!1),V=v([]),P=v([]),p=v("grid"),a=U({keyword:"",categoryId:null,location:"",minPrice:"",maxPrice:"",sortBy:"created_at"}),s=U({page:1,limit:12,total:0,pages:0}),K=async()=>{try{const e=await N.get("/categories");e.data.status==="success"&&(P.value=e.data.data.categories)}catch(e){console.error("获取分类失败:",e)}},m=async()=>{try{g.value=!0;const e={page:s.page,limit:s.limit,sort:a.sortBy};a.keyword&&(e.search=a.keyword),a.categoryId&&(e.category_id=a.categoryId),a.location&&(e.location=a.location),a.minPrice&&(e.min_price=a.minPrice),a.maxPrice&&(e.max_price=a.maxPrice);const o=await N.get("/resources",{params:e});o.data.status==="success"&&(V.value=o.data.data.resources,Object.assign(s,o.data.data.pagination))}catch(e){console.error("获取资源列表失败:",e),te.error("获取资源列表失败")}finally{g.value=!1}},d=()=>{s.page=1,m(),y()},D=()=>{Object.assign(a,{keyword:"",categoryId:null,location:"",minPrice:"",maxPrice:"",sortBy:"created_at"}),s.page=1,m(),y()},F=e=>{s.page=e,m(),y()},j=e=>{s.limit=e,s.page=1,m(),y()},E=()=>{localStorage.setItem("resources_view_mode",p.value)},O=e=>{x.push(`/resources/${e}`)},y=()=>{const e={};a.keyword&&(e.search=a.keyword),a.categoryId&&(e.category=a.categoryId),a.location&&(e.location=a.location),a.minPrice&&(e.min_price=a.minPrice),a.maxPrice&&(e.max_price=a.maxPrice),a.sortBy!=="created_at"&&(e.sort=a.sortBy),s.page>1&&(e.page=s.page),s.limit!==12&&(e.limit=s.limit),x.replace({query:e})},B=()=>{const e=C.query;e.search&&(a.keyword=e.search),e.category&&(a.categoryId=Number(e.category)),e.location&&(a.location=e.location),e.min_price&&(a.minPrice=e.min_price),e.max_price&&(a.maxPrice=e.max_price),e.sort&&(a.sortBy=e.sort),e.page&&(s.page=Number(e.page)),e.limit&&(s.limit=Number(e.limit))},T=()=>{const e=localStorage.getItem("resources_view_mode");e&&(p.value=e)};return W(()=>C.query,()=>{B(),m()},{deep:!0}),X(()=>{T(),B(),K(),m()}),(e,o)=>{const b=i("el-icon"),w=i("el-button"),f=i("el-input"),_=i("el-option"),I=i("el-select"),z=i("el-radio-button"),$=i("el-radio-group"),A=i("el-empty"),L=i("el-pagination"),Q=Y("loading");return n(),u("div",ne,[c("div",ce,[c("div",de,[c("div",ue,[l(f,{modelValue:a.keyword,"onUpdate:modelValue":o[0]||(o[0]=t=>a.keyword=t),placeholder:"搜索物品...",size:"large",clearable:"",onKeyup:h(d,["enter"])},{append:r(()=>[l(w,{onClick:d},{default:r(()=>[l(b,null,{default:r(()=>[l(k(le))]),_:1})]),_:1})]),_:1},8,["modelValue"])]),c("div",pe,[l(I,{modelValue:a.categoryId,"onUpdate:modelValue":o[1]||(o[1]=t=>a.categoryId=t),placeholder:"选择分类",clearable:"",onChange:d},{default:r(()=>[(n(!0),u(R,null,S(P.value,t=>(n(),M(_,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),l(f,{modelValue:a.location,"onUpdate:modelValue":o[2]||(o[2]=t=>a.location=t),placeholder:"位置",clearable:"",onKeyup:h(d,["enter"])},null,8,["modelValue"]),c("div",me,[l(f,{modelValue:a.minPrice,"onUpdate:modelValue":o[3]||(o[3]=t=>a.minPrice=t),placeholder:"最低价",type:"number",onKeyup:h(d,["enter"])},null,8,["modelValue"]),o[9]||(o[9]=c("span",null,"-",-1)),l(f,{modelValue:a.maxPrice,"onUpdate:modelValue":o[4]||(o[4]=t=>a.maxPrice=t),placeholder:"最高价",type:"number",onKeyup:h(d,["enter"])},null,8,["modelValue"])]),l(I,{modelValue:a.sortBy,"onUpdate:modelValue":o[5]||(o[5]=t=>a.sortBy=t),placeholder:"排序方式",onChange:d},{default:r(()=>[l(_,{label:"最新发布",value:"created_at"}),l(_,{label:"价格从低到高",value:"price_asc"}),l(_,{label:"价格从高到低",value:"price_desc"}),l(_,{label:"浏览量最多",value:"view_count"})]),_:1},8,["modelValue"]),l(w,{type:"primary",onClick:d},{default:r(()=>o[10]||(o[10]=[q("搜索")])),_:1,__:[10]}),l(w,{onClick:D},{default:r(()=>o[11]||(o[11]=[q("重置")])),_:1,__:[11]})])]),c("div",_e,[c("span",null,"共找到 "+Z(s.total)+" 件物品",1),c("div",ge,[l($,{modelValue:p.value,"onUpdate:modelValue":o[6]||(o[6]=t=>p.value=t),onChange:E},{default:r(()=>[l(z,{label:"grid"},{default:r(()=>[l(b,null,{default:r(()=>[l(k(se))]),_:1})]),_:1}),l(z,{label:"list"},{default:r(()=>[l(b,null,{default:r(()=>[l(k(re))]),_:1})]),_:1})]),_:1},8,["modelValue"])])]),ee((n(),u("div",ye,[V.value.length===0&&!g.value?(n(),u("div",fe,[l(A,{description:"暂无相关物品"})])):(n(),u("div",{key:1,class:ae(["resources-grid",p.value])},[(n(!0),u(R,null,S(V.value,t=>(n(),M(ie,{key:t.id,resource:t,"view-mode":p.value,onClick:be=>O(t.id)},null,8,["resource","view-mode","onClick"]))),128))],2))])),[[Q,g.value]]),s.total>0?(n(),u("div",ve,[l(L,{"current-page":s.page,"onUpdate:currentPage":o[7]||(o[7]=t=>s.page=t),"page-size":s.limit,"onUpdate:pageSize":o[8]||(o[8]=t=>s.limit=t),total:s.total,"page-sizes":[12,24,48,96],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:j,onCurrentChange:F},null,8,["current-page","page-size","total"])])):oe("",!0)])])}}},xe=G(he,[["__scopeId","data-v-a7e7cea6"]]);export{xe as default};
