import{a8 as N,a9 as A,aa as B,ab as I,_ as q,r as h,a as T,b as g,c as w,e as f,w as m,l as W,ac as z,i as v,t as _,F as G,f as H,d as l,ad as j,z as x,ae as S,E as P,D as $,o as J}from"./index-4f31dd00.js";function K(r){r.CapacitorUtils.Synapse=new Proxy({},{get(t,s){return new Proxy({},{get(a,e){return(n,i,u)=>{const d=r.Capacitor.Plugins[s];if(d===void 0){u(new Error(`Capacitor plugin ${s} not found`));return}if(typeof d[e]!="function"){u(new Error(`Method ${e} not found in Capacitor plugin ${s}`));return}(async()=>{try{const c=await d[e](n);i(c)}catch(c){u(c)}})()}}})}})}function Q(r){r.CapacitorUtils.Synapse=new Proxy({},{get(t,s){return r.cordova.plugins[s]}})}function X(r=!1){typeof window>"u"||(window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!r?K(window):window.cordova!==void 0&&Q(window))}const Y=N("Geolocation",{web:()=>A(()=>import("./web-3fc73742.js"),["assets/web-3fc73742.js","assets/index-4f31dd00.js","assets/index-4ed86ae4.css"]).then(r=>new r.GeolocationWeb)});X();const Z=N("Device",{web:()=>A(()=>import("./web-3c0d0829.js"),["assets/web-3c0d0829.js","assets/index-4f31dd00.js","assets/index-4ed86ae4.css"]).then(r=>new r.DeviceWeb)}),V=N("Network",{web:()=>A(()=>import("./web-a3b57e33.js"),["assets/web-a3b57e33.js","assets/index-4f31dd00.js","assets/index-4ed86ae4.css"]).then(r=>new r.NetworkWeb)});var C;(function(r){r.Prompt="PROMPT",r.Camera="CAMERA",r.Photos="PHOTOS"})(C||(C={}));var R;(function(r){r.Rear="REAR",r.Front="FRONT"})(R||(R={}));var F;(function(r){r.Uri="uri",r.Base64="base64",r.DataUrl="dataUrl"})(F||(F={}));class ee extends B{async getPhoto(t){return new Promise(async(s,a)=>{if(t.webUseInput||t.source===C.Photos)this.fileInputExperience(t,s,a);else if(t.source===C.Prompt){let e=document.querySelector("pwa-action-sheet");e||(e=document.createElement("pwa-action-sheet"),document.body.appendChild(e)),e.header=t.promptLabelHeader||"Photo",e.cancelable=!1,e.options=[{title:t.promptLabelPhoto||"From Photos"},{title:t.promptLabelPicture||"Take Picture"}],e.addEventListener("onSelection",async n=>{n.detail===0?this.fileInputExperience(t,s,a):this.cameraExperience(t,s,a)})}else this.cameraExperience(t,s,a)})}async pickImages(t){return new Promise(async(s,a)=>{this.multipleFileInputExperience(s,a)})}async cameraExperience(t,s,a){if(customElements.get("pwa-camera-modal")){const e=document.createElement("pwa-camera-modal");e.facingMode=t.direction===R.Front?"user":"environment",document.body.appendChild(e);try{await e.componentOnReady(),e.addEventListener("onPhoto",async n=>{const i=n.detail;i===null?a(new I("User cancelled photos app")):i instanceof Error?a(i):s(await this._getCameraPhoto(i,t)),e.dismiss(),document.body.removeChild(e)}),e.present()}catch{this.fileInputExperience(t,s,a)}}else console.error("Unable to load PWA Element 'pwa-camera-modal'. See the docs: https://capacitorjs.com/docs/web/pwa-elements."),this.fileInputExperience(t,s,a)}fileInputExperience(t,s,a){let e=document.querySelector("#_capacitor-camera-input");const n=()=>{var i;(i=e.parentNode)===null||i===void 0||i.removeChild(e)};e||(e=document.createElement("input"),e.id="_capacitor-camera-input",e.type="file",e.hidden=!0,document.body.appendChild(e),e.addEventListener("change",i=>{const u=e.files[0];let d="jpeg";if(u.type==="image/png"?d="png":u.type==="image/gif"&&(d="gif"),t.resultType==="dataUrl"||t.resultType==="base64"){const c=new FileReader;c.addEventListener("load",()=>{if(t.resultType==="dataUrl")s({dataUrl:c.result,format:d});else if(t.resultType==="base64"){const y=c.result.split(",")[1];s({base64String:y,format:d})}n()}),c.readAsDataURL(u)}else s({webPath:URL.createObjectURL(u),format:d}),n()}),e.addEventListener("cancel",i=>{a(new I("User cancelled photos app")),n()})),e.accept="image/*",e.capture=!0,t.source===C.Photos||t.source===C.Prompt?e.removeAttribute("capture"):t.direction===R.Front?e.capture="user":t.direction===R.Rear&&(e.capture="environment"),e.click()}multipleFileInputExperience(t,s){let a=document.querySelector("#_capacitor-camera-input-multiple");const e=()=>{var n;(n=a.parentNode)===null||n===void 0||n.removeChild(a)};a||(a=document.createElement("input"),a.id="_capacitor-camera-input-multiple",a.type="file",a.hidden=!0,a.multiple=!0,document.body.appendChild(a),a.addEventListener("change",n=>{const i=[];for(let u=0;u<a.files.length;u++){const d=a.files[u];let c="jpeg";d.type==="image/png"?c="png":d.type==="image/gif"&&(c="gif"),i.push({webPath:URL.createObjectURL(d),format:c})}t({photos:i}),e()}),a.addEventListener("cancel",n=>{s(new I("User cancelled photos app")),e()})),a.accept="image/*",a.click()}_getCameraPhoto(t,s){return new Promise((a,e)=>{const n=new FileReader,i=t.type.split("/")[1];s.resultType==="uri"?a({webPath:URL.createObjectURL(t),format:i,saved:!1}):(n.readAsDataURL(t),n.onloadend=()=>{const u=n.result;s.resultType==="dataUrl"?a({dataUrl:u,format:i,saved:!1}):a({base64String:u.split(",")[1],format:i,saved:!1})},n.onerror=u=>{e(u)})})}async checkPermissions(){if(typeof navigator>"u"||!navigator.permissions)throw this.unavailable("Permissions API not available in this browser");try{return{camera:(await window.navigator.permissions.query({name:"camera"})).state,photos:"granted"}}catch{throw this.unavailable("Camera permissions are not available in this browser")}}async requestPermissions(){throw this.unimplemented("Not implemented on web.")}async pickLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}async getLimitedLibraryPhotos(){throw this.unavailable("Not implemented on web.")}}const te=N("Camera",{web:()=>new ee});const ae={class:"mobile-camera"},ne={key:0,class:"photo-preview"},oe=["src","alt"],se={__name:"MobileCamera",emits:["photos-updated"],setup(r,{expose:t,emit:s}){const a=s,e=h(!1),n=h([]),i=async()=>{try{if(e.value=!0,!S.isNativePlatform()){const y=document.createElement("input");y.type="file",y.accept="image/*",y.multiple=!0,y.onchange=u,y.click();return}const c=await te.getPhoto({quality:80,allowEditing:!1,resultType:F.Uri,source:C.Camera});n.value.push({webPath:c.webPath,format:c.format}),a("photos-updated",n.value),P.success("照片添加成功")}catch(c){console.error("拍照失败:",c),P.error("拍照失败，请重试")}finally{e.value=!1}},u=c=>{const y=Array.from(c.target.files);y.forEach(b=>{const E=new FileReader;E.onload=L=>{n.value.push({webPath:L.target.result,format:b.type.split("/")[1],file:b}),a("photos-updated",n.value)},E.readAsDataURL(b)}),e.value=!1,P.success(`已选择 ${y.length} 张照片`)},d=c=>{n.value.splice(c,1),a("photos-updated",n.value),P.success("照片已删除")};return t({photos:n,clearPhotos:()=>{n.value=[],a("photos-updated",n.value)}}),(c,y)=>{const b=T("el-icon"),E=T("el-button");return g(),w("div",ae,[f(E,{type:"primary",onClick:i,loading:e.value,class:"camera-button"},{default:m(()=>[f(b,null,{default:m(()=>[f(W(z))]),_:1}),v(" "+_(e.value?"拍照中...":"拍照上传"),1)]),_:1},8,["loading"]),n.value.length>0?(g(),w("div",ne,[(g(!0),w(G,null,H(n.value,(L,k)=>(g(),w("div",{key:k,class:"photo-item"},[l("img",{src:L.webPath,alt:`照片 ${k+1}`},null,8,oe),f(E,{type:"danger",size:"small",onClick:D=>d(k),class:"remove-btn"},{default:m(()=>[f(b,null,{default:m(()=>[f(W(j))]),_:1})]),_:2},1032,["onClick"])]))),128))])):x("",!0)])}}},ie=q(se,[["__scopeId","data-v-974a6941"]]);const le={class:"mobile-test"},re={class:"test-header"},ce={class:"test-sections"},ue={class:"info-item"},de={class:"info-item"},pe={class:"info-item"},me={key:0,class:"photo-info"},fe={key:0,class:"location-info"},ve={key:0,class:"device-info"},_e={class:"network-status"},ye={key:0},he={__name:"MobileTest",setup(r){const t=h({platform:"",isNative:!1}),s=h(window.innerWidth),a=h(0),e=h(null),n=h(!1),i=h(null),u=h(!1),d=h({connected:!1,connectionType:""}),c=h(null),y=$(()=>t.value.isNative?"success":"info"),b=$(()=>t.value.isNative?"移动端原生":"Web浏览器"),E=p=>{a.value=p.length},L=async()=>{try{n.value=!0;const p=await Y.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4});e.value={latitude:p.coords.latitude.toFixed(6),longitude:p.coords.longitude.toFixed(6),accuracy:p.coords.accuracy.toFixed(0)},P.success("位置获取成功")}catch(p){console.error("获取位置失败:",p),P.error("获取位置失败: "+p.message)}finally{n.value=!1}},k=async()=>{try{u.value=!0;const p=await Z.getInfo();i.value=p,P.success("设备信息获取成功")}catch(p){console.error("获取设备信息失败:",p),P.error("获取设备信息失败")}finally{u.value=!1}},D=async()=>{try{const p=await V.getStatus();d.value={connected:p.connected,connectionType:p.connectionType}}catch(p){console.error("获取网络状态失败:",p)}};return J(async()=>{t.value={platform:S.getPlatform(),isNative:S.isNativePlatform()},window.addEventListener("resize",()=>{s.value=window.innerWidth}),await D(),V.addListener("networkStatusChange",p=>{d.value={connected:p.connected,connectionType:p.connectionType}})}),(p,o)=>{const M=T("el-tag"),U=T("el-card"),O=T("el-button");return g(),w("div",le,[l("div",re,[o[0]||(o[0]=l("h2",null,"移动端功能测试",-1)),f(M,{type:y.value},{default:m(()=>[v(_(b.value),1)]),_:1},8,["type"])]),l("div",ce,[f(U,{class:"test-card"},{header:m(()=>o[1]||(o[1]=[l("span",null,"平台信息",-1)])),default:m(()=>[l("div",ue,[o[2]||(o[2]=l("strong",null,"平台类型:",-1)),v(" "+_(t.value.platform),1)]),l("div",de,[o[3]||(o[3]=l("strong",null,"是否原生:",-1)),v(" "+_(t.value.isNative?"是":"否"),1)]),l("div",pe,[o[4]||(o[4]=l("strong",null,"屏幕宽度:",-1)),v(" "+_(s.value)+"px ",1)])]),_:1}),f(U,{class:"test-card"},{header:m(()=>o[5]||(o[5]=[l("span",null,"相机功能",-1)])),default:m(()=>[f(ie,{onPhotosUpdated:E,ref_key:"cameraRef",ref:c},null,512),a.value>0?(g(),w("div",me," 已拍摄 "+_(a.value)+" 张照片 ",1)):x("",!0)]),_:1}),f(U,{class:"test-card"},{header:m(()=>o[6]||(o[6]=[l("span",null,"地理位置",-1)])),default:m(()=>[f(O,{onClick:L,loading:n.value},{default:m(()=>o[7]||(o[7]=[v(" 获取当前位置 ")])),_:1,__:[7]},8,["loading"]),e.value?(g(),w("div",fe,[l("div",null,[o[8]||(o[8]=l("strong",null,"纬度:",-1)),v(" "+_(e.value.latitude),1)]),l("div",null,[o[9]||(o[9]=l("strong",null,"经度:",-1)),v(" "+_(e.value.longitude),1)]),l("div",null,[o[10]||(o[10]=l("strong",null,"精度:",-1)),v(" "+_(e.value.accuracy)+"m",1)])])):x("",!0)]),_:1}),f(U,{class:"test-card"},{header:m(()=>o[11]||(o[11]=[l("span",null,"设备信息",-1)])),default:m(()=>[f(O,{onClick:k,loading:u.value},{default:m(()=>o[12]||(o[12]=[v(" 获取设备信息 ")])),_:1,__:[12]},8,["loading"]),i.value?(g(),w("div",ve,[l("div",null,[o[13]||(o[13]=l("strong",null,"操作系统:",-1)),v(" "+_(i.value.operatingSystem),1)]),l("div",null,[o[14]||(o[14]=l("strong",null,"平台:",-1)),v(" "+_(i.value.platform),1)]),l("div",null,[o[15]||(o[15]=l("strong",null,"是否虚拟设备:",-1)),v(" "+_(i.value.isVirtual?"是":"否"),1)])])):x("",!0)]),_:1}),f(U,{class:"test-card"},{header:m(()=>o[16]||(o[16]=[l("span",null,"网络状态",-1)])),default:m(()=>[l("div",_e,[f(M,{type:d.value.connected?"success":"danger"},{default:m(()=>[v(_(d.value.connected?"已连接":"未连接"),1)]),_:1},8,["type"]),d.value.connectionType?(g(),w("div",ye," 连接类型: "+_(d.value.connectionType),1)):x("",!0)])]),_:1})])])}}},we=q(he,[["__scopeId","data-v-034fdc18"]]);export{we as default};
