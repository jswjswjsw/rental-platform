import{_ as K,p as Q,u as W,I as X,r as j,D as V,o as Z,a as v,b as i,c as _,d as s,e as o,w as r,g as b,E as u,i as l,l as c,U as h,t as d,T as ee,M as D,H as x,O as A,h as C,z as m,F as $,J as E,V as R}from"./index-4f31dd00.js";const se={class:"order-detail-page"},te={class:"container"},re={class:"page-header"},oe={key:0,class:"loading"},ae={key:1,class:"order-detail"},ne={class:"card-header"},le={class:"order-info"},de={class:"info-row"},ie={class:"value"},ue={class:"info-row"},ce={class:"value"},_e={class:"info-row"},pe={class:"value"},ve={class:"info-row"},fe={class:"value"},me={class:"info-row"},ye={class:"value"},ge={class:"resource-info"},ke={class:"resource-image"},we=["src","alt"],Ce={class:"resource-details"},$e={class:"price-info"},Oe={class:"price-row"},be={class:"price"},De={class:"price-row"},xe={class:"price"},Be={class:"price-row total"},Ie={class:"price"},Se={class:"users-info"},ze={class:"user-item"},Me={class:"user-details"},Ne={class:"username"},Ue={class:"user-item"},je={class:"user-details"},Ve={class:"username"},Ae={class:"order-actions"},Ee={key:2,class:"error-state"},Re={__name:"OrderDetail",setup(Te){const T=Q(),Y=W(),g=X(),O=j(!0),t=j(null),B=V(()=>g.user&&t.value&&g.user.id===t.value.owner_id),H=V(()=>g.user&&t.value&&g.user.id===t.value.renter_id),F=a=>{if(!a)return"/images/placeholder.jpg";if(Array.isArray(a))return a.length>0?E(a[0]):"/images/placeholder.jpg";try{const e=JSON.parse(a);return e.length>0?E(e[0]):"/images/placeholder.jpg"}catch{return"/images/placeholder.jpg"}},I=async()=>{try{O.value=!0;const a=T.params.id,e=await b.get(`/orders/${a}`);e.data.status==="success"?t.value=e.data.data.order:u.error("获取订单详情失败")}catch(a){console.error("获取订单详情失败:",a),u.error("获取订单详情失败")}finally{O.value=!1}},y=async(a,e)=>{if(!t.value||!t.value.id){u.error("订单信息不完整，无法执行操作");return}try{await R.confirm(e,"提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}),await b.put(`/orders/${t.value.id}/status`,{status:a}),u.success("操作成功"),await I()}catch(n){n!=="cancel"&&(console.error("操作失败:",n),u.error("操作失败"))}},S=async a=>{if(!t.value){u.error("订单信息不完整");return}try{const e=a==="owner"?t.value.owner_id:t.value.renter_id,n=a==="owner"?t.value.owner_name:t.value.renter_name,k=await b.get(`/users/${e}`);if(k.data.status==="success"){const w=k.data.data.user,p=w.phone||w.email;p?R.alert(`${n}的联系方式：${p}`,`联系${a==="owner"?"房东":"租客"}`,{confirmButtonText:"知道了",type:"info"}):u.info(`${n}暂未设置联系方式`)}else u.error("获取联系方式失败")}catch(e){console.error("获取联系方式失败:",e),u.error("获取联系方式失败")}},z=a=>{if(!t.value||!t.value.id){u.error("订单信息不完整，无法进行支付");return}Y.push({path:"/payment",query:{orderId:t.value.id,type:a}}).catch(e=>{console.error("跳转支付页面失败:",e),u.error("跳转支付页面失败")})},J=()=>y("confirmed","确认接受这个租赁订单吗？"),P=()=>y("cancelled","确定要拒绝这个订单吗？"),M=()=>y("cancelled","确定要取消这个订单吗？"),q=()=>y("ongoing","确认开始租赁吗？"),L=()=>y("completed","确认已完成此次租赁吗？");return Z(()=>{I()}),(a,e)=>{const n=v("el-button"),k=v("el-skeleton"),w=v("el-tag"),p=v("el-card"),N=v("el-icon"),U=v("el-avatar"),G=v("el-empty");return i(),_("div",se,[s("div",te,[s("div",re,[o(n,{onClick:e[0]||(e[0]=f=>a.$router.back()),icon:"ArrowLeft"},{default:r(()=>e[7]||(e[7]=[l("返回")])),_:1,__:[7]}),e[8]||(e[8]=s("h1",null,"订单详情",-1))]),O.value?(i(),_("div",oe,[o(k,{rows:8,animated:""})])):t.value?(i(),_("div",ae,[o(p,{class:"order-info-card"},{header:r(()=>[s("div",ne,[e[9]||(e[9]=s("span",null,"订单信息",-1)),o(w,{type:c(h)(t.value.status),size:"large"},{default:r(()=>[l(d(c(ee)(t.value.status)),1)]),_:1},8,["type"])])]),default:r(()=>[s("div",le,[s("div",de,[e[10]||(e[10]=s("span",{class:"label"},"订单号：",-1)),s("span",ie,d(t.value.order_no),1)]),s("div",ue,[e[11]||(e[11]=s("span",{class:"label"},"下单时间：",-1)),s("span",ce,d(c(D)(t.value.created_at,"YYYY-MM-DD HH:mm:ss")),1)]),s("div",_e,[e[12]||(e[12]=s("span",{class:"label"},"租赁时间：",-1)),s("span",pe,d(c(D)(t.value.start_date))+" 至 "+d(c(D)(t.value.end_date)),1)]),s("div",ve,[e[13]||(e[13]=s("span",{class:"label"},"租赁天数：",-1)),s("span",fe,d(t.value.days)+" 天",1)]),s("div",me,[e[14]||(e[14]=s("span",{class:"label"},"备注：",-1)),s("span",ye,d(t.value.remark||"无"),1)])])]),_:1}),o(p,{class:"resource-info-card"},{header:r(()=>e[15]||(e[15]=[s("span",null,"租赁物品",-1)])),default:r(()=>[s("div",ge,[s("div",ke,[s("img",{src:F(t.value.resource_images),alt:t.value.resource_title},null,8,we)]),s("div",Ce,[s("h3",null,d(t.value.resource_title),1),s("div",$e,[s("div",Oe,[e[16]||(e[16]=s("span",{class:"label"},"日租金：",-1)),s("span",be,"¥"+d(c(x)(t.value.daily_price)),1)]),s("div",De,[e[17]||(e[17]=s("span",{class:"label"},"押金：",-1)),s("span",xe,"¥"+d(c(x)(t.value.deposit)),1)]),s("div",Be,[e[18]||(e[18]=s("span",{class:"label"},"总计：",-1)),s("span",Ie,"¥"+d(c(x)(t.value.total_price)),1)])])])])]),_:1}),o(p,{class:"users-info-card"},{header:r(()=>e[19]||(e[19]=[s("span",null,"参与用户",-1)])),default:r(()=>[s("div",Se,[s("div",ze,[e[21]||(e[21]=s("div",{class:"user-role"},"租客",-1)),s("div",Me,[o(U,{src:t.value.renter_avatar,size:40},{default:r(()=>[o(N,null,{default:r(()=>[o(c(A))]),_:1})]),_:1},8,["src"]),s("span",Ne,d(t.value.renter_name),1),H.value?m("",!0):(i(),C(n,{key:0,size:"small",type:"primary",onClick:e[1]||(e[1]=f=>S("renter"))},{default:r(()=>e[20]||(e[20]=[l(" 联系租客 ")])),_:1,__:[20]}))])]),s("div",Ue,[e[23]||(e[23]=s("div",{class:"user-role"},"房东",-1)),s("div",je,[o(U,{src:t.value.owner_avatar,size:40},{default:r(()=>[o(N,null,{default:r(()=>[o(c(A))]),_:1})]),_:1},8,["src"]),s("span",Ve,d(t.value.owner_name),1),B.value?m("",!0):(i(),C(n,{key:0,size:"small",type:"primary",onClick:e[2]||(e[2]=f=>S("owner"))},{default:r(()=>e[22]||(e[22]=[l(" 联系房东 ")])),_:1,__:[22]}))])])])]),_:1}),o(p,{class:"order-actions-card"},{header:r(()=>e[24]||(e[24]=[s("span",null,"订单操作",-1)])),default:r(()=>[s("div",Ae,[t.value.status==="pending"?(i(),_($,{key:0},[B.value?(i(),_($,{key:0},[o(n,{type:"primary",onClick:J},{default:r(()=>e[25]||(e[25]=[l("确认订单")])),_:1,__:[25]}),o(n,{type:"danger",onClick:P},{default:r(()=>e[26]||(e[26]=[l("拒绝订单")])),_:1,__:[26]})],64)):(i(),_($,{key:1},[o(n,{type:"primary",onClick:e[3]||(e[3]=f=>z("rent"))},{default:r(()=>e[27]||(e[27]=[l("支付租金")])),_:1,__:[27]}),o(n,{type:"warning",onClick:e[4]||(e[4]=f=>z("deposit"))},{default:r(()=>e[28]||(e[28]=[l("支付押金")])),_:1,__:[28]}),o(n,{type:"danger",onClick:M},{default:r(()=>e[29]||(e[29]=[l("取消订单")])),_:1,__:[29]})],64))],64)):m("",!0),t.value.status==="confirmed"?(i(),_($,{key:1},[o(n,{type:"success",onClick:q},{default:r(()=>e[30]||(e[30]=[l("开始租赁")])),_:1,__:[30]}),o(n,{type:"danger",onClick:M},{default:r(()=>e[31]||(e[31]=[l("取消订单")])),_:1,__:[31]})],64)):m("",!0),t.value.status==="ongoing"?(i(),C(n,{key:2,type:"success",onClick:L},{default:r(()=>e[32]||(e[32]=[l("确认完成")])),_:1,__:[32]})):m("",!0),["completed","cancelled"].includes(t.value.status)?(i(),C(n,{key:3,onClick:e[5]||(e[5]=f=>a.$router.push("/orders"))},{default:r(()=>e[33]||(e[33]=[l("返回订单列表")])),_:1,__:[33]})):m("",!0)])]),_:1})])):(i(),_("div",Ee,[o(G,{description:"订单不存在或已被删除"},{default:r(()=>[o(n,{type:"primary",onClick:e[6]||(e[6]=f=>a.$router.push("/orders"))},{default:r(()=>e[34]||(e[34]=[l("返回订单列表")])),_:1,__:[34]})]),_:1})]))])])}}},He=K(Re,[["__scopeId","data-v-0981deb2"]]);export{He as default};
