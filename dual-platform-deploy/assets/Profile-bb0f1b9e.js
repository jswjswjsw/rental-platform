import{_ as me,u as ve,I as ge,r as w,q as J,o as we,a as u,v as ye,b as _,c as m,d as o,e as s,w as a,g as R,E as r,l as c,O as L,W as be,X as Pe,Y as ke,N as Ve,i,z as x,S as he,y as O,h as xe,t as k,H as G,Q as Ce,M as Re,F as $e,f as Me,R as W,V as H,J as Q}from"./index-4f31dd00.js";const Fe={class:"profile-page"},Ue={class:"container"},Be={class:"profile-content"},Se={class:"profile-panel"},ze={key:0,class:"info-panel"},Te={key:1,class:"avatar-panel"},Ie={class:"avatar-section"},Ne={class:"current-avatar"},Ae={class:"avatar-upload"},Ee={key:2,class:"password-panel"},je={key:3,class:"resources-panel"},qe={class:"resources-actions"},De={class:"resources-list"},Je={key:4,class:"favorites-panel"},Le={key:0,class:"empty-state"},Oe={key:1,class:"favorites-grid"},Ge=["onClick"],We={class:"favorite-image"},He=["src","alt"],Qe={class:"favorite-content"},Xe={class:"favorite-price"},Ye={class:"favorite-location"},Ke={class:"favorite-actions"},Ze={__name:"Profile",setup(es){const I=ve(),v=ge(),y=w("info"),$=w(!1),M=w(!1),F=w(!1),C=w(!1),N=w([]),U=w([]),B=w(),S=w(),n=J({username:"",email:"",real_name:"",phone:""}),p=J({oldPassword:"",newPassword:"",confirmPassword:""}),X={real_name:[{max:50,message:"真实姓名不能超过50个字符",trigger:"blur"}],phone:[{pattern:/^1[3-9]\d{9}$/,message:"请输入正确的手机号",trigger:"blur"}]},Y={oldPassword:[{required:!0,message:"请输入原密码",trigger:"blur"}],newPassword:[{required:!0,message:"请输入新密码",trigger:"blur"},{min:6,message:"密码长度不能少于6位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请确认新密码",trigger:"blur"},{validator:(l,e,d)=>{e!==p.newPassword?d(new Error("两次输入的密码不一致")):d()},trigger:"blur"}]},K=l=>{y.value=l,l==="resources"?z():l==="favorites"&&A()},Z=async()=>{if(B.value)try{if(!await B.value.validate())return;$.value=!0;const e=await v.updateProfile({real_name:n.real_name,phone:n.phone});e.success?r.success("信息更新成功"):r.error(e.message||"更新失败")}catch(l){console.error("更新用户信息失败:",l),r.error("更新失败，请稍后重试")}finally{$.value=!1}},ee=l=>{const e=l.type.startsWith("image/"),d=l.size/1024/1024<2;return e?d?!0:(r.error("图片大小不能超过 2MB!"),!1):(r.error("只能上传图片文件!"),!1)},se=async({file:l})=>{try{const e=await v.uploadAvatar(l);e.success?r.success("头像更新成功"):r.error(e.message||"上传失败")}catch(e){console.error("上传头像失败:",e),r.error("上传失败，请稍后重试")}},ae=async()=>{if(S.value)try{if(!await S.value.validate())return;M.value=!0;const e=await v.changePassword({oldPassword:p.oldPassword,newPassword:p.newPassword});e.success?(r.success("密码修改成功"),Object.keys(p).forEach(d=>{p[d]=""})):r.error(e.message||"修改失败")}catch(l){console.error("修改密码失败:",l),r.error("修改失败，请稍后重试")}finally{M.value=!1}},z=async()=>{try{F.value=!0;const l=await R.get("/users/resources");l.data.status==="success"&&(N.value=l.data.data.resources)}catch(l){console.error("加载我的物品失败:",l),r.error("加载失败，请稍后重试")}finally{F.value=!1}},le=l=>({available:"success",rented:"warning",maintenance:"info",offline:"danger"})[l]||"info",T=l=>{I.push(`/resources/${l}`)},te=l=>{I.push(`/publish?edit=${l}`)},oe=async l=>{try{await H.confirm("确定要删除这个物品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),(await R.delete(`/resources/${l}`)).data.status==="success"&&(r.success("删除成功"),z())}catch(e){e!=="cancel"&&(console.error("删除物品失败:",e),r.error("删除失败，请稍后重试"))}},A=async()=>{try{C.value=!0;const l=await R.get("/favorites");l.data.status==="success"&&(U.value=l.data.data.favorites)}catch(l){console.error("加载收藏失败:",l),r.error("加载收藏失败，请稍后重试")}finally{C.value=!1}},re=l=>{if(!l)return"/images/placeholder.jpg";if(Array.isArray(l))return l.length>0?Q(l[0]):"/images/placeholder.jpg";try{const e=JSON.parse(l);return e.length>0?Q(e[0]):"/images/placeholder.jpg"}catch{return"/images/placeholder.jpg"}},ne=async l=>{try{await H.confirm("确定要取消收藏这个物品吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}),await R.delete(`/favorites/${l}`),r.success("取消收藏成功"),A()}catch(e){e!=="cancel"&&(console.error("取消收藏失败:",e),r.error("取消收藏失败，请稍后重试"))}};return we(()=>{v.user&&(n.username=v.user.username,n.email=v.user.email,n.real_name=v.user.real_name||"",n.phone=v.user.phone||"");const e=new URLSearchParams(window.location.search).get("tab");e&&["info","avatar","password","resources"].includes(e)&&(y.value=e,e==="resources"&&z())}),(l,e)=>{const d=u("el-icon"),V=u("el-menu-item"),ue=u("el-menu"),E=u("el-col"),b=u("el-input"),g=u("el-form-item"),f=u("el-button"),j=u("el-form"),de=u("el-avatar"),ie=u("el-upload"),P=u("el-table-column"),pe=u("el-tag"),ce=u("el-table"),_e=u("el-empty"),fe=u("el-row"),q=ye("loading");return _(),m("div",Fe,[o("div",Ue,[e[30]||(e[30]=o("div",{class:"profile-header"},[o("h1",null,"个人中心"),o("p",null,"管理您的个人信息和账户设置")],-1)),o("div",Be,[s(fe,{gutter:20},{default:a(()=>[s(E,{span:6},{default:a(()=>[s(ue,{"default-active":y.value,onSelect:K,class:"profile-menu"},{default:a(()=>[s(V,{index:"info"},{default:a(()=>[s(d,null,{default:a(()=>[s(c(L))]),_:1}),e[9]||(e[9]=o("span",null,"基本信息",-1))]),_:1,__:[9]}),s(V,{index:"avatar"},{default:a(()=>[s(d,null,{default:a(()=>[s(c(be))]),_:1}),e[10]||(e[10]=o("span",null,"头像设置",-1))]),_:1,__:[10]}),s(V,{index:"password"},{default:a(()=>[s(d,null,{default:a(()=>[s(c(Pe))]),_:1}),e[11]||(e[11]=o("span",null,"修改密码",-1))]),_:1,__:[11]}),s(V,{index:"resources"},{default:a(()=>[s(d,null,{default:a(()=>[s(c(ke))]),_:1}),e[12]||(e[12]=o("span",null,"我的物品",-1))]),_:1,__:[12]}),s(V,{index:"favorites"},{default:a(()=>[s(d,null,{default:a(()=>[s(c(Ve))]),_:1}),e[13]||(e[13]=o("span",null,"我的收藏",-1))]),_:1,__:[13]})]),_:1},8,["default-active"])]),_:1}),s(E,{span:18},{default:a(()=>{var D;return[o("div",Se,[y.value==="info"?(_(),m("div",ze,[e[15]||(e[15]=o("h3",null,"基本信息",-1)),s(j,{ref_key:"infoFormRef",ref:B,model:n,rules:X,"label-width":"100px"},{default:a(()=>[s(g,{label:"用户名",prop:"username"},{default:a(()=>[s(b,{modelValue:n.username,"onUpdate:modelValue":e[0]||(e[0]=t=>n.username=t),disabled:""},null,8,["modelValue"])]),_:1}),s(g,{label:"邮箱",prop:"email"},{default:a(()=>[s(b,{modelValue:n.email,"onUpdate:modelValue":e[1]||(e[1]=t=>n.email=t),disabled:""},null,8,["modelValue"])]),_:1}),s(g,{label:"真实姓名",prop:"real_name"},{default:a(()=>[s(b,{modelValue:n.real_name,"onUpdate:modelValue":e[2]||(e[2]=t=>n.real_name=t),placeholder:"请输入真实姓名"},null,8,["modelValue"])]),_:1}),s(g,{label:"手机号",prop:"phone"},{default:a(()=>[s(b,{modelValue:n.phone,"onUpdate:modelValue":e[3]||(e[3]=t=>n.phone=t),placeholder:"请输入手机号"},null,8,["modelValue"])]),_:1}),s(g,null,{default:a(()=>[s(f,{type:"primary",onClick:Z,loading:$.value},{default:a(()=>e[14]||(e[14]=[i(" 保存修改 ")])),_:1,__:[14]},8,["loading"])]),_:1})]),_:1},8,["model"])])):x("",!0),y.value==="avatar"?(_(),m("div",Te,[e[18]||(e[18]=o("h3",null,"头像设置",-1)),o("div",Ie,[o("div",Ne,[s(de,{src:(D=c(v).user)==null?void 0:D.avatar,size:120},{default:a(()=>[s(d,{size:"60"},{default:a(()=>[s(c(L))]),_:1})]),_:1},8,["src"])]),o("div",Ae,[s(ie,{"show-file-list":!1,"before-upload":ee,"http-request":se,accept:"image/*"},{default:a(()=>[s(f,{type:"primary"},{default:a(()=>e[16]||(e[16]=[i("上传新头像")])),_:1,__:[16]})]),_:1}),e[17]||(e[17]=o("p",{class:"upload-tip"},"支持 JPG、PNG 格式，文件大小不超过 2MB",-1))])])])):x("",!0),y.value==="password"?(_(),m("div",Ee,[e[20]||(e[20]=o("h3",null,"修改密码",-1)),s(j,{ref_key:"passwordFormRef",ref:S,model:p,rules:Y,"label-width":"100px"},{default:a(()=>[s(g,{label:"原密码",prop:"oldPassword"},{default:a(()=>[s(b,{modelValue:p.oldPassword,"onUpdate:modelValue":e[4]||(e[4]=t=>p.oldPassword=t),type:"password","show-password":"",placeholder:"请输入原密码"},null,8,["modelValue"])]),_:1}),s(g,{label:"新密码",prop:"newPassword"},{default:a(()=>[s(b,{modelValue:p.newPassword,"onUpdate:modelValue":e[5]||(e[5]=t=>p.newPassword=t),type:"password","show-password":"",placeholder:"请输入新密码"},null,8,["modelValue"])]),_:1}),s(g,{label:"确认密码",prop:"confirmPassword"},{default:a(()=>[s(b,{modelValue:p.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=t=>p.confirmPassword=t),type:"password","show-password":"",placeholder:"请再次输入新密码"},null,8,["modelValue"])]),_:1}),s(g,null,{default:a(()=>[s(f,{type:"primary",onClick:ae,loading:M.value},{default:a(()=>e[19]||(e[19]=[i(" 修改密码 ")])),_:1,__:[19]},8,["loading"])]),_:1})]),_:1},8,["model"])])):x("",!0),y.value==="resources"?(_(),m("div",je,[e[25]||(e[25]=o("h3",null,"我的物品",-1)),o("div",qe,[s(f,{type:"primary",onClick:e[7]||(e[7]=t=>l.$router.push("/publish"))},{default:a(()=>[s(d,null,{default:a(()=>[s(c(he))]),_:1}),e[21]||(e[21]=i(" 发布新物品 "))]),_:1,__:[21]})]),o("div",De,[O((_(),xe(ce,{data:N.value},{default:a(()=>[s(P,{prop:"title",label:"物品名称"}),s(P,{prop:"price_per_day",label:"日租金"},{default:a(({row:t})=>[i(" ¥"+k(c(G)(t.price_per_day)),1)]),_:1}),s(P,{prop:"status",label:"状态"},{default:a(({row:t})=>[s(pe,{type:le(t.status)},{default:a(()=>[i(k(c(Ce)(t.status)),1)]),_:2},1032,["type"])]),_:1}),s(P,{prop:"view_count",label:"浏览量"}),s(P,{prop:"created_at",label:"发布时间"},{default:a(({row:t})=>[i(k(c(Re)(t.created_at)),1)]),_:1}),s(P,{label:"操作",width:"200"},{default:a(({row:t})=>[s(f,{size:"small",onClick:h=>T(t.id)},{default:a(()=>e[22]||(e[22]=[i("查看")])),_:2,__:[22]},1032,["onClick"]),s(f,{size:"small",type:"primary",onClick:h=>te(t.id)},{default:a(()=>e[23]||(e[23]=[i("编辑")])),_:2,__:[23]},1032,["onClick"]),s(f,{size:"small",type:"danger",onClick:h=>oe(t.id)},{default:a(()=>e[24]||(e[24]=[i("删除")])),_:2,__:[24]},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[q,F.value]])])])):x("",!0),y.value==="favorites"?(_(),m("div",Je,[e[29]||(e[29]=o("h3",null,"我的收藏",-1)),U.value.length===0&&!C.value?(_(),m("div",Le,[s(_e,{description:"暂无收藏物品"},{default:a(()=>[s(f,{type:"primary",onClick:e[8]||(e[8]=t=>l.$router.push("/resources"))},{default:a(()=>e[26]||(e[26]=[i(" 去找物品 ")])),_:1,__:[26]})]),_:1})])):O((_(),m("div",Oe,[(_(!0),m($e,null,Me(U.value,t=>(_(),m("div",{key:t.id,class:"favorite-card",onClick:h=>T(t.resource_id)},[o("div",We,[o("img",{src:re(t.images),alt:t.title},null,8,He)]),o("div",Qe,[o("h4",null,k(t.title),1),o("p",Xe,"¥"+k(c(G)(t.price_per_day))+"/天",1),o("p",Ye,k(t.location||"位置未知"),1),o("div",Ke,[s(f,{size:"small",type:"primary",onClick:W(h=>T(t.resource_id),["stop"])},{default:a(()=>e[27]||(e[27]=[i(" 查看详情 ")])),_:2,__:[27]},1032,["onClick"]),s(f,{size:"small",type:"danger",onClick:W(h=>ne(t.resource_id),["stop"])},{default:a(()=>e[28]||(e[28]=[i(" 取消收藏 ")])),_:2,__:[28]},1032,["onClick"])])])],8,Ge))),128))])),[[q,C.value]])])):x("",!0)])]}),_:1})]),_:1})])])])}}},as=me(Ze,[["__scopeId","data-v-cbdef6a3"]]);export{as as default};
