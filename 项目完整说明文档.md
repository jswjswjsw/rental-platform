# 闲置资源租赁平台 - 完整项目说明文档

## 📋 项目概述

### 项目简介
闲置资源租赁平台是一个基于现代Web技术栈构建的完整租赁系统，旨在帮助用户充分利用闲置物品，通过租赁的方式实现资源共享和价值最大化。

### 技术架构
- **前端**：Vue 3 + Element Plus + Pinia + Vue Router + Vite
- **后端**：Node.js + Express + MySQL + JWT
- **数据库**：MySQL 8.0+
- **开发工具**：Vite、ESLint、Prettier

### 核心功能
1. **用户管理系统**：注册、登录、个人信息管理、头像上传
2. **资源管理系统**：发布、编辑、搜索、分类管理、图片上传
3. **订单管理系统**：租赁申请、状态流转、订单查询
4. **评价系统**：用户互评、评分统计、信誉建立
5. **安全系统**：JWT认证、权限控制、数据验证

---

## 🏗️ 项目结构详解

### 整体目录结构
```
闲置资源租赁平台/
├── qianduan/                    # 前端Vue3应用
│   ├── src/                     # 源代码目录
│   │   ├── components/          # 可复用组件
│   │   │   ├── auth/           # 认证相关组件
│   │   │   │   ├── LoginForm.vue      # 登录表单组件
│   │   │   │   └── RegisterForm.vue   # 注册表单组件
│   │   │   ├── layout/         # 布局组件
│   │   │   │   ├── AppHeader.vue      # 应用头部导航
│   │   │   │   └── AppFooter.vue      # 应用底部信息
│   │   │   ├── resource/       # 资源相关组件
│   │   │   │   └── ResourceCard.vue   # 资源卡片组件
│   │   │   └── rental/         # 租赁相关组件
│   │   │       └── RentalForm.vue     # 租赁申请表单
│   │   ├── views/              # 页面组件
│   │   │   ├── Home.vue               # 首页
│   │   │   ├── Resources.vue          # 资源列表页
│   │   │   ├── ResourceDetail.vue     # 资源详情页
│   │   │   ├── Publish.vue            # 发布资源页
│   │   │   ├── Orders.vue             # 订单管理页
│   │   │   ├── Login.vue              # 登录页
│   │   │   ├── Register.vue           # 注册页
│   │   │   ├── About.vue              # 关于我们页
│   │   │   ├── Help.vue               # 帮助中心页
│   │   │   └── NotFound.vue           # 404页面
│   │   ├── stores/             # Pinia状态管理
│   │   │   └── user.js                # 用户状态管理
│   │   ├── utils/              # 工具函数
│   │   │   ├── api.js                 # HTTP请求封装
│   │   │   └── index.js               # 通用工具函数
│   │   ├── router/             # 路由配置
│   │   │   └── index.js               # 路由定义和守卫
│   │   ├── App.vue             # 根组件
│   │   ├── main.js             # 应用入口
│   │   └── style.css           # 全局样式
│   ├── index.html              # HTML模板
│   ├── package.json            # 前端依赖配置
│   └── vite.config.js          # Vite构建配置
├── houduan/                     # 后端Node.js应用
│   ├── config/                 # 配置文件
│   │   └── database.js                # 数据库连接配置
│   ├── middleware/             # 中间件
│   │   ├── auth.js                    # JWT认证中间件
│   │   └── upload.js                  # 文件上传中间件
│   ├── routes/                 # 路由处理
│   │   ├── auth.js                    # 用户认证路由
│   │   ├── users.js                   # 用户管理路由
│   │   ├── categories.js              # 分类管理路由
│   │   ├── resources.js               # 资源管理路由
│   │   ├── orders.js                  # 订单管理路由
│   │   └── reviews.js                 # 评价管理路由
│   ├── uploads/                # 文件上传目录
│   │   ├── avatars/                   # 用户头像
│   │   └── resources/                 # 资源图片
│   ├── app.js                  # 主应用文件
│   ├── package.json            # 后端依赖配置
│   └── .env                    # 环境变量配置
├── shujuku/                     # 数据库相关
│   └── init.sql                       # 数据库初始化脚本
├── start-all.bat               # 一键启动脚本
└── README.md                   # 项目说明文档
```

---

## 🔧 详细功能说明

### 1. 用户管理系统

#### 1.1 用户注册 (`/api/auth/register`)
**功能描述**：新用户注册功能
**请求方式**：POST
**请求参数**：
```json
{
  "username": "用户名（3-20位字母数字下划线）",
  "email": "邮箱地址",
  "password": "密码（最少6位，包含字母和数字）",
  "phone": "手机号（可选）",
  "real_name": "真实姓名（可选）"
}
```
**业务规则**：
- 用户名和邮箱全局唯一
- 密码使用bcrypt加密存储
- 支持手机号和真实姓名可选填写
- 注册成功自动生成JWT Token

#### 1.2 用户登录 (`/api/auth/login`)
**功能描述**：用户登录验证
**请求方式**：POST
**请求参数**：
```json
{
  "username": "用户名或邮箱",
  "password": "登录密码"
}
```
**业务规则**：
- 支持用户名或邮箱登录
- 密码验证使用bcrypt
- 登录成功返回JWT Token
- 检查用户状态（active/inactive/banned）

#### 1.3 个人信息管理
**功能包含**：
- 获取当前用户信息 (`GET /api/auth/me`)
- 更新个人资料 (`PUT /api/users/profile`)
- 上传用户头像 (`POST /api/users/avatar`)
- 修改登录密码 (`PUT /api/auth/password`)

### 2. 资源管理系统

#### 2.1 资源发布 (`/api/resources`)
**功能描述**：用户发布闲置资源
**请求方式**：POST
**请求参数**：
```json
{
  "category_id": "分类ID",
  "title": "资源标题",
  "description": "资源描述",
  "price_per_day": "日租金",
  "deposit": "押金（可选）",
  "location": "资源位置",
  "contact_info": "联系方式（可选）",
  "images": "图片文件数组（最多5张）"
}
```
**业务规则**：
- 支持多图片上传（最多5张，每张最大5MB）
- 图片格式限制：JPEG、PNG、GIF、WebP
- 自动生成唯一文件名防止冲突
- 发布后状态默认为"可租赁"

#### 2.2 资源搜索 (`/api/resources`)
**功能描述**：多条件搜索资源
**请求方式**：GET
**查询参数**：
```
?search=关键词
&category_id=分类ID
&min_price=最低价格
&max_price=最高价格
&location=位置
&sort=排序方式
&page=页码
&limit=每页数量
```
**排序方式**：
- `created_at`: 按发布时间排序（默认）
- `price_asc`: 按价格从低到高
- `price_desc`: 按价格从高到低
- `view_count`: 按浏览量排序

#### 2.3 资源详情 (`/api/resources/:id`)
**功能描述**：获取资源详细信息
**包含信息**：
- 资源基本信息（标题、描述、价格等）
- 资源图片数组
- 发布者信息
- 浏览量统计
- 相关推荐资源
- 平均评分和评价数量

### 3. 订单管理系统

#### 3.1 订单状态流转
```
pending（待确认）
    ↓ 资源拥有者确认
confirmed（已确认）
    ↓ 开始租赁
ongoing（进行中）
    ↓ 租赁完成
completed（已完成）

任何状态都可以转为：
cancelled（已取消）
dispute（争议中）
```

#### 3.2 创建订单 (`/api/orders`)
**功能描述**：租赁者提交租赁申请
**请求方式**：POST
**请求参数**：
```json
{
  "resource_id": "资源ID",
  "start_date": "开始日期",
  "end_date": "结束日期",
  "remark": "备注信息（可选）"
}
```
**业务规则**：
- 不能租赁自己的资源
- 检查时间段冲突
- 自动计算租赁天数和总价
- 生成唯一订单号

#### 3.3 订单操作权限
| 操作 | 待确认 | 已确认 | 进行中 | 已完成 | 已取消 |
|------|--------|--------|--------|--------|--------|
| 确认订单 | 拥有者 | - | - | - | - |
| 取消订单 | 双方 | 双方 | - | - | - |
| 开始租赁 | - | 拥有者 | - | - | - |
| 完成订单 | - | - | 双方 | - | - |
| 发起争议 | - | 双方 | 双方 | - | - |

### 4. 评价系统

#### 4.1 评价规则
- 每个用户对每个资源只能评价一次
- 评分范围：1-5分（整数）
- 支持文字评价和图片上传
- 评价后自动更新资源平均评分

#### 4.2 评价操作
- 创建评价 (`POST /api/reviews`)
- 更新评价 (`PUT /api/reviews/:id`)
- 删除评价 (`DELETE /api/reviews/:id`)
- 查看资源评价 (`GET /api/reviews/resource/:resourceId`)
- 查看用户评价 (`GET /api/reviews/user/:userId`)

---

## 🔒 安全机制

### 1. 认证和授权
- **JWT Token**：用户登录后获得Token，有效期7天
- **Token验证**：所有需要认证的接口都会验证Token
- **权限控制**：不同操作需要不同权限级别
- **用户状态检查**：禁用用户无法进行操作

### 2. 数据验证
- **前端验证**：使用Element Plus表单验证
- **后端验证**：使用Joi进行数据格式验证
- **SQL注入防护**：使用参数化查询
- **XSS防护**：输入数据转义处理

### 3. 文件上传安全
- **文件类型限制**：只允许图片格式
- **文件大小限制**：单文件最大5MB
- **文件名处理**：生成唯一文件名
- **存储路径隔离**：不同类型文件分目录存储

### 4. 网络安全
- **CORS配置**：跨域请求控制
- **Helmet防护**：HTTP安全头设置
- **请求限流**：防止API滥用
- **HTTPS支持**：生产环境使用HTTPS

---

## 📊 数据库设计

### 1. 表结构说明

#### users（用户表）
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | INT | 用户ID | 主键，自增 |
| username | VARCHAR(50) | 用户名 | 唯一，非空 |
| email | VARCHAR(100) | 邮箱 | 唯一，非空 |
| password | VARCHAR(255) | 密码 | 非空，加密存储 |
| phone | VARCHAR(20) | 手机号 | 可空 |
| avatar | VARCHAR(255) | 头像URL | 默认头像 |
| real_name | VARCHAR(50) | 真实姓名 | 可空 |
| status | ENUM | 用户状态 | active/inactive/banned |
| created_at | TIMESTAMP | 创建时间 | 自动设置 |
| updated_at | TIMESTAMP | 更新时间 | 自动更新 |

#### categories（分类表）
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | INT | 分类ID | 主键，自增 |
| name | VARCHAR(50) | 分类名称 | 非空 |
| description | TEXT | 分类描述 | 可空 |
| icon | VARCHAR(100) | 图标标识 | 可空 |
| sort_order | INT | 排序权重 | 默认0 |
| status | ENUM | 分类状态 | active/inactive |
| created_at | TIMESTAMP | 创建时间 | 自动设置 |

#### resources（资源表）
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | INT | 资源ID | 主键，自增 |
| user_id | INT | 发布用户ID | 外键，非空 |
| category_id | INT | 分类ID | 外键，非空 |
| title | VARCHAR(200) | 资源标题 | 非空 |
| description | TEXT | 资源描述 | 可空 |
| images | JSON | 图片数组 | JSON格式 |
| price_per_day | DECIMAL(10,2) | 日租金 | 非空 |
| deposit | DECIMAL(10,2) | 押金 | 默认0 |
| location | VARCHAR(200) | 位置信息 | 可空 |
| contact_info | VARCHAR(500) | 联系方式 | 可空 |
| status | ENUM | 资源状态 | available/rented/maintenance/offline |
| view_count | INT | 浏览次数 | 默认0 |
| rating | DECIMAL(3,1) | 平均评分 | 默认0 |
| review_count | INT | 评价数量 | 默认0 |
| created_at | TIMESTAMP | 创建时间 | 自动设置 |
| updated_at | TIMESTAMP | 更新时间 | 自动更新 |

#### rental_orders（订单表）
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | INT | 订单ID | 主键，自增 |
| order_no | VARCHAR(32) | 订单号 | 唯一，非空 |
| resource_id | INT | 资源ID | 外键，非空 |
| renter_id | INT | 租赁者ID | 外键，非空 |
| owner_id | INT | 拥有者ID | 外键，非空 |
| start_date | DATE | 开始日期 | 非空 |
| end_date | DATE | 结束日期 | 非空 |
| days | INT | 租赁天数 | 非空 |
| daily_price | DECIMAL(10,2) | 日租金 | 非空 |
| total_price | DECIMAL(10,2) | 总金额 | 非空 |
| deposit | DECIMAL(10,2) | 押金 | 默认0 |
| status | ENUM | 订单状态 | pending/confirmed/ongoing/completed/cancelled/dispute |
| remark | TEXT | 备注信息 | 可空 |
| created_at | TIMESTAMP | 创建时间 | 自动设置 |
| updated_at | TIMESTAMP | 更新时间 | 自动更新 |

#### reviews（评价表）
| 字段 | 类型 | 说明 | 约束 |
|------|------|------|------|
| id | INT | 评价ID | 主键，自增 |
| user_id | INT | 评价用户ID | 外键，非空 |
| resource_id | INT | 资源ID | 外键，非空 |
| rating | INT | 评分 | 1-5分，非空 |
| comment | TEXT | 评价内容 | 可空 |
| images | JSON | 评价图片 | JSON格式 |
| created_at | TIMESTAMP | 创建时间 | 自动设置 |
| updated_at | TIMESTAMP | 更新时间 | 自动更新 |

### 2. 索引设计
- **主键索引**：所有表的id字段
- **唯一索引**：username、email、order_no等唯一字段
- **外键索引**：提高关联查询性能
- **业务索引**：status、category_id、rating等常用筛选字段

### 3. 外键约束
- **级联删除**：用户删除时删除其资源和订单
- **限制删除**：分类有资源时不能删除
- **数据完整性**：确保关联数据的一致性

---

## 🚀 部署指南

### 1. 环境要求
- **Node.js**：版本 >= 16.0.0
- **MySQL**：版本 >= 8.0
- **npm**：版本 >= 8.0.0

### 2. 快速部署

#### 2.1 使用一键启动脚本（推荐）
```bash
# Windows用户
双击运行 start-all.bat

# 或命令行执行
./start-all.bat
```

#### 2.2 手动部署
```bash
# 1. 克隆项目
git clone <项目地址>
cd 闲置资源租赁平台

# 2. 初始化数据库
mysql -u root -p < shujuku/init.sql

# 3. 配置后端环境变量
cd houduan
cp .env.example .env
# 编辑.env文件，配置数据库连接信息

# 4. 安装后端依赖并启动
npm install
npm run dev

# 5. 安装前端依赖并启动（新终端）
cd ../qianduan
npm install
npm run dev
```

### 3. 环境配置

#### 3.1 后端环境变量 (.env)
```env
# 数据库配置
DB_HOST=localhost
DB_PORT=3306
DB_USER=root
DB_PASSWORD=your_password
DB_NAME=rental_platform

# JWT配置
JWT_SECRET=your-super-secret-jwt-key-change-in-production
JWT_EXPIRES_IN=7d

# 服务器配置
PORT=3000
NODE_ENV=development

# 文件上传配置
UPLOAD_PATH=./uploads
MAX_FILE_SIZE=5242880
```

#### 3.2 生产环境配置
```env
# 生产环境配置示例
NODE_ENV=production
PORT=3000
JWT_SECRET=your-very-strong-secret-key
DB_HOST=your-production-db-host
DB_PASSWORD=your-strong-db-password

# 启用HTTPS
HTTPS_ENABLED=true
SSL_CERT_PATH=/path/to/cert.pem
SSL_KEY_PATH=/path/to/key.pem
```

### 4. 访问地址
- **前端应用**：http://localhost:8080
- **后端API**：http://localhost:3000/api
- **健康检查**：http://localhost:3000/api/health

---

## 🧪 测试指南

### 1. 测试账号
系统预置了测试账号，可直接使用：

| 用户名 | 密码 | 角色 | 说明 |
|--------|------|------|------|
| admin | 123456 | 管理员 | 系统管理员账号 |
| testuser | 123456 | 普通用户 | 测试用户账号 |

### 2. 功能测试流程

#### 2.1 用户注册登录测试
1. 访问注册页面，填写用户信息
2. 验证表单验证规则
3. 注册成功后跳转登录页面
4. 使用注册的账号登录
5. 验证登录状态和用户信息显示

#### 2.2 资源管理测试
1. 登录后访问"发布物品"页面
2. 填写资源信息并上传图片
3. 发布成功后在资源列表中查看
4. 测试搜索和筛选功能
5. 查看资源详情页面

#### 2.3 订单流程测试
1. 浏览资源列表，选择可租赁资源
2. 点击"立即租赁"提交申请
3. 使用资源拥有者账号确认订单
4. 测试订单状态流转
5. 完成订单并进行评价

### 3. API测试
可以使用Postman或其他API测试工具测试后端接口：

#### 3.1 认证接口测试
```bash
# 用户注册
POST http://localhost:3000/api/auth/register
Content-Type: application/json

{
  "username": "testuser2",
  "email": "test2@example.com",
  "password": "123456"
}

# 用户登录
POST http://localhost:3000/api/auth/login
Content-Type: application/json

{
  "username": "testuser2",
  "password": "123456"
}
```

#### 3.2 资源接口测试
```bash
# 获取资源列表
GET http://localhost:3000/api/resources?page=1&limit=10

# 获取资源详情
GET http://localhost:3000/api/resources/1

# 发布资源（需要认证）
POST http://localhost:3000/api/resources
Authorization: Bearer <your-jwt-token>
Content-Type: multipart/form-data

# 表单数据...
```

---

## 🔧 开发指南

### 1. 开发环境搭建
```bash
# 安装依赖
npm install

# 启动开发服务器
npm run dev

# 构建生产版本
npm run build

# 预览生产版本
npm run preview
```

### 2. 代码规范

#### 2.1 前端代码规范
- 使用Vue 3 Composition API
- 组件名使用PascalCase
- 文件名使用kebab-case
- 使用ESLint和Prettier格式化代码
- 添加详细的JSDoc注释

#### 2.2 后端代码规范
- 使用ES6+语法
- 异步操作使用async/await
- 错误处理使用try-catch
- API响应格式统一
- 添加详细的函数注释

### 3. 新功能开发流程

#### 3.1 添加新的API接口
1. 在对应的路由文件中添加路由处理函数
2. 使用Joi进行数据验证
3. 添加适当的认证中间件
4. 处理错误和异常情况
5. 返回统一格式的响应
6. 添加详细的注释说明

#### 3.2 添加新的前端页面
1. 在views目录创建页面组件
2. 在router中添加路由配置
3. 添加页面权限控制
4. 实现响应式布局
5. 添加加载状态和错误处理
6. 编写详细的组件注释

### 4. 调试技巧

#### 4.1 前端调试
- 使用Vue DevTools浏览器扩展
- 在浏览器控制台查看网络请求
- 使用console.log输出调试信息
- 利用Vue的响应式特性调试状态变化

#### 4.2 后端调试
- 使用console.log输出调试信息
- 查看数据库查询日志
- 使用Postman测试API接口
- 检查中间件执行顺序

---

## 📈 性能优化

### 1. 前端性能优化
- **代码分割**：使用动态导入实现路由懒加载
- **图片优化**：压缩图片，使用WebP格式
- **缓存策略**：合理设置HTTP缓存头
- **打包优化**：使用Vite的构建优化功能

### 2. 后端性能优化
- **数据库优化**：添加合适的索引，优化查询语句
- **连接池**：使用数据库连接池管理连接
- **缓存机制**：对热点数据进行缓存
- **压缩响应**：启用gzip压缩

### 3. 数据库优化
- **索引优化**：为常用查询字段添加索引
- **查询优化**：避免N+1查询问题
- **分页查询**：大数据量使用分页
- **连接优化**：合理使用JOIN查询

---

## 🛠️ 故障排除

### 1. 常见问题

#### 1.1 启动失败
**问题**：服务启动失败
**解决方案**：
1. 检查Node.js版本是否符合要求
2. 检查端口是否被占用
3. 检查数据库连接配置
4. 查看错误日志定位问题

#### 1.2 数据库连接失败
**问题**：无法连接数据库
**解决方案**：
1. 检查MySQL服务是否启动
2. 验证数据库连接参数
3. 检查数据库用户权限
4. 确认数据库是否已创建

#### 1.3 文件上传失败
**问题**：图片上传不成功
**解决方案**：
1. 检查uploads目录权限
2. 验证文件大小和格式
3. 检查磁盘空间
4. 查看服务器错误日志

#### 1.4 前端页面空白
**问题**：前端页面显示空白
**解决方案**：
1. 检查浏览器控制台错误
2. 验证API接口是否正常
3. 检查路由配置
4. 确认组件导入路径

### 2. 日志查看
- **前端日志**：浏览器开发者工具控制台
- **后端日志**：服务器控制台输出
- **数据库日志**：MySQL错误日志
- **网络日志**：浏览器网络面板

### 3. 性能监控
- **前端性能**：使用Lighthouse分析
- **后端性能**：监控API响应时间
- **数据库性能**：查看慢查询日志
- **服务器性能**：监控CPU和内存使用

---

## 📚 扩展功能建议

### 1. 功能增强
- **实时聊天**：集成WebSocket实现用户间实时沟通
- **地图定位**：集成地图API显示资源位置
- **支付系统**：集成第三方支付平台
- **消息通知**：邮件和短信通知功能
- **数据统计**：用户行为分析和统计报表

### 2. 技术升级
- **微服务架构**：拆分为多个独立服务
- **容器化部署**：使用Docker容器化部署
- **CDN加速**：静态资源使用CDN分发
- **负载均衡**：多实例负载均衡
- **监控告警**：完善的监控和告警系统

### 3. 移动端支持
- **响应式优化**：进一步优化移动端体验
- **PWA支持**：添加Progressive Web App功能
- **原生应用**：开发iOS和Android原生应用
- **小程序**：开发微信小程序版本

---

## 📞 技术支持

### 1. 联系方式
- **邮箱**：support@rental-platform.com
- **QQ群**：123456789
- **微信群**：扫描二维码加入
- **GitHub**：提交Issue获得帮助

### 2. 文档资源
- **API文档**：详细的接口文档
- **开发指南**：开发最佳实践
- **部署手册**：生产环境部署指南
- **FAQ**：常见问题解答

### 3. 社区支持
- **技术论坛**：开发者交流社区
- **视频教程**：功能使用教程
- **代码示例**：丰富的代码示例
- **最佳实践**：行业最佳实践分享

---

## 📄 许可证

本项目采用 MIT 许可证，详情请查看 [LICENSE](LICENSE) 文件。

---

## 🙏 致谢

感谢所有为这个项目做出贡献的开发者和用户！

**项目维护团队**
- 项目负责人：开发团队
- 前端开发：Vue.js团队
- 后端开发：Node.js团队
- 数据库设计：数据库团队
- UI/UX设计：设计团队

**技术栈致谢**
- Vue.js - 渐进式JavaScript框架
- Element Plus - Vue 3组件库
- Express.js - Node.js Web框架
- MySQL - 关系型数据库
- 以及所有其他优秀的开源项目

---

*最后更新时间：2024年1月1日*
*文档版本：v1.0.0*